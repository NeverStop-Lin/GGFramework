## KCC 角色控制器使用说明

本控制器基于 Kinematic Character Controller（KCC），实现了：
- 移动
- 跳跃（可配置多段跳）
- 飞扑（可被跳跃打断，空中可飞扑）
- 趴下（调整胶囊体）
- 爬梯子（Layer/Tag 检测）
- 爬墙（缓慢滑落）
- 登墙跳

### 目录结构

```
Assets/GameApp/Character/
├── 配置/
│   └── 角色控制器配置.cs
├── 核心/
│   ├── 角色控制器.cs
│   ├── 角色输入.cs
│   └── 角色状态.cs
└── 使用说明.md
```

### 依赖

- 已导入 Kinematic Character Controller（KCC）并存在 `KinematicCharacterMotor` 组件
- 项目使用旧版 Input Manager（Unity Input）

## 快速开始

1) 在 Project 面板右键创建配置
- 路径：Create → GameApp → 角色 → 角色控制器配置
- 将新建的 `默认角色配置` 拖入角色控制器组件的 `配置` 字段

2) 在角色物体上添加组件
- 添加 `KinematicCharacterMotor`
- 添加 `角色控制器`（并关联 `KinematicCharacterMotor`、`配置`、可选 `网格根节点`）
- 添加 `角色输入`（会自动绑定同物体上的 `角色控制器`）

3) 设置层与标签（用于爬梯子/爬墙）
- 梯子：给可爬的梯子碰撞体设置 Layer 为 `配置.梯子层`，或设置 Tag 为 `配置.梯子Tag`（默认 Ladder）
- 可爬墙：给可爬墙的碰撞体设置 Layer 为 `配置.可爬墙层`

4) 输入映射（旧 Input Manager）
- 水平/垂直：`Horizontal` / `Vertical`
- 跳跃：Space（可在 `角色输入` 中修改）
- 飞扑：LeftShift
- 切换趴下：LeftControl

## 参数说明（来自 ScriptableObject 配置）

- 基础移动
  - 最大稳定移动速度：地面最大移动速度
  - 稳定移动锐度：地面加速插值
  - 方向插值锐度：面向朝向插值
- 空中移动
  - 最大空中移动速度、空中加速度、空中阻力、重力
- 跳跃
  - 斜坡可跳：在不稳定地面是否允许起跳
  - 跳起速度、跳跃前向速度
  - 最大跳跃次数：多段跳次数上限
  - 土狼时间：离地后仍可起跳的宽限
  - 跳跃缓冲时间：提前按跳跃的容忍
- 飞扑
  - 飞扑初速度、持续时间、衰减、冷却时间
  - 空中飞扑消耗一次跳跃：开启后空中飞扑会计入一次跳跃消耗
- 趴下/蹲伏
  - 蹲伏身高、站立身高、胶囊半径、蹲伏移动速度倍率
- 爬梯子
  - 梯子检测半径、检测距离、爬梯子速度、梯子Tag、梯子层
- 爬墙/登墙跳
  - 可爬墙层、可爬墙最大表面角度、贴墙检测距离
  - 下滑速度、抓墙最久时间、登墙跳上升/后退速度

## 行为说明

- 移动：WASD 控制平面移动；角色面向移动方向
- 跳跃：
  - 地面起跳重置跳跃计数；空中可消耗剩余次数继续跳
  - 支持土狼时间与跳跃缓冲，容错较好
- 飞扑：
  - 按下飞扑键沿移动/朝向方向冲刺；可在空中使用（可选消耗一次跳跃）
  - 按跳跃会打断飞扑并执行跳跃
- 趴下：
  - 切换趴下调整胶囊高度；站起前会进行头顶空间检测，空间不足不会站起
- 爬梯子：
  - 前进靠近梯子时自动吸附，进入后忽略重力，仅沿上/下方向移动
  - 跳跃或远离梯子退出
- 爬墙/登墙跳：
  - 空中正面撞到可爬墙表面进入爬墙；会缓慢下滑
  - 在爬墙状态按跳跃会立刻退出为空中（登墙跳力度由跳跃参数与前向速度决定）

## 集成建议

- 将相机复用 KCC 示例相机或项目自有第三人称相机，跟随 `角色控制器` 所在物体
- 关卡中将可交互物体正确设置 Layer/Tag，避免误触
- 根据关卡感觉调参：先调移动、跳跃，再调飞扑，最后调爬梯/爬墙

## 常见问题排查（FAQ）

- 角色无法起跳：
  - 检查是否接地（KCC 的 GroundingStatus）
  - 土狼/缓冲时间过短，或最大跳跃次数设置过小
- 站不起来：
  - 头顶空间不足；确认周围碰撞体与 Layer 设置
- 无法进入梯子：
  - 梯子对象未设置到 `配置.梯子层` 或 Tag 不匹配
  - 检测距离/半径过小，适当增大
- 无法触发爬墙：
  - 目标表面 Layer 未包含在 `配置.可爬墙层`
  - 表面角度太小（更像斜坡）；调大“可爬墙最大表面角度”或调整关卡法线

## 版本与维护

- 代码命名、注释与异常信息遵循工程规范（中文命名，英文异常文本）
- 若升级 KCC，请重点复测：ForceUnground、GroundingStatus、SetCapsuleDimensions 行为



