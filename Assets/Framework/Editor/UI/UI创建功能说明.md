# UI预制体创建功能使用说明

## 功能概述

UI管理器现在支持通过模板快速创建空的UI预制体，无需手动创建GameObject和添加Canvas组件。

## 新增功能

### 1. 设置Tab新增"UI创建设置"区域

- **默认创建路径**：配置创建UI预制体时的默认保存位置
- 该路径会自动添加到Prefab目录列表，且在UI管理Tab中标记为"[默认创建路径]"
- 默认创建路径不可从目录列表中删除

### 2. UI管理Tab新增"创建UI预制体"按钮

在工具栏中添加了醒目的绿色"✚ 创建UI预制体"按钮。

### 3. UI模板系统

在 `Assets/Framework/Editor/UI/Template/` 目录下自动生成 `DefaultUITemplate.prefab`

**模板包含**：
- Canvas（Screen Space - Overlay模式）
- Canvas Scaler（Scale With Screen Size模式）
- Graphic Raycaster

## 使用流程

### 创建新UI预制体

1. 打开UI管理器：`Tools > Framework > UI Manager`
2. 切换到"UI管理"Tab
3. 点击工具栏的"✚ 创建UI预制体"按钮
4. 在弹出的配置对话框中设置：
   - **UI名称**：自动填充默认名称（如 UI_001, UI_002），可手动修改
     - 只能包含字母、数字、下划线
     - 不能以数字开头
     - 不能与现有UI重名
   - **保存目录**：默认使用设置中配置的目录，可点击"浏览"按钮修改
     - 只保存目录路径，文件名由UI名称自动生成
   - **UI层级**：从下拉列表中选择UI所在的层级（如Main、Popup等）
   - **UI模板**：从下拉列表中选择模板
     - 显示模板预制体的名称（去掉Template后缀）
     - 每次打开对话框都会自动扫描Template目录
     - 支持多个模板，框架开发者可添加更多模板到Template目录
5. 点击"创建"按钮
6. 系统自动执行以下操作：
   - 基于选择的模板创建预制体副本
   - 应用项目配置的Canvas Scaler设置
   - 扫描预制体生成组件绑定代码
   - 生成 Logic.cs 和 Binding.cs 脚本
   - 编译完成后自动将脚本绑定到预制体
   - 更新UI配置表

### 配置默认创建路径

1. 打开UI管理器的"设置"Tab
2. 在"UI创建设置"区域中点击"浏览"按钮
3. 选择目录作为默认创建路径
4. 点击"保存设置"

## 技术细节

### 自动配置

创建UI预制体时，系统会自动：
- 应用项目配置的参考分辨率（宽度、高度）
- 应用项目配置的屏幕匹配模式（Match Width Or Height值）
- 将新创建的预制体添加到扫描列表

### 名称验证

UI名称必须符合以下规则：
- 不能为空或仅包含空白字符
- 必须符合C#命名规范（字母、数字、下划线，不以数字开头）
- 不能与现有UI名称冲突

### 目录管理

- 默认创建路径在目录列表中标记为"[默认创建路径]"
- 默认创建路径不允许删除，确保创建功能始终可用
- 可以添加多个Prefab扫描目录，但只有一个默认创建路径

## 扩展功能

### 自动恢复模板

如果模板被删除或损坏，系统会在下次打开 UI 管理器时自动重新生成，无需手动操作。

### 自定义模板

1. 修改 `Assets/Framework/Editor/UI/Template/DefaultUITemplate.prefab`
2. 或在 `UITemplateGenerator.cs` 中添加新的模板生成逻辑
3. 在 `UIManagementTab.cs` 的 `CreateNewUIPrefab()` 方法中选择不同的模板

## 技术说明

### 模板拷贝机制

创建UI时使用的是**完全独立的拷贝**，不是prefab引用关系：

1. 实例化模板预制体
2. 使用 `UnpackPrefabInstance` 彻底断开prefab连接
3. 应用项目配置
4. 保存为全新的独立预制体

**结果**：创建的UI预制体没有"Base"引用，完全独立，可以自由修改而不影响模板。

## 注意事项

1. **首次使用**：模板会在首次打开UI管理器时自动生成
2. **路径要求**：UI预制体必须保存在Assets目录下
3. **名称唯一性**：确保UI名称在项目中唯一
4. **Canvas配置**：创建后的Canvas Scaler配置与项目配置保持一致
5. **完全独立**：创建的UI与模板完全独立，修改UI不会影响模板

## 删除UI功能

### 灵活的删除选项

删除UI时可以精确选择要删除的内容：

1. 点击UI行的"删除"按钮
2. 在弹出的对话框中勾选要删除的内容：
   - ☑️ **预制体 (Prefab)** - 删除 .prefab 文件
   - ☑️ **逻辑脚本 (Logic.cs)** - 删除业务逻辑代码
   - ☑️ **绑定脚本 (Binding.cs)** - 删除自动生成的绑定代码
   - ☑️ **UI配置表记录** - 从配置表中移除
3. 使用快捷按钮：
   - **全选** - 选择所有可删除的内容
   - **全不选** - 取消所有选择
   - **仅代码** - 只删除脚本，保留预制体和配置
4. 点击"确认删除"

**默认行为**：默认勾选代码和配置，不勾选预制体（保护数据安全）

### 批量删除

选中多个UI后点击"批量删除"：
- 统一应用相同的删除选项到所有选中的UI
- 显示成功和失败的数量
- 自动刷新列表

## 示例

### 创建主菜单UI

1. 点击"✚ 创建UI预制体"
2. 输入名称：`MainMenu`
3. 选择保存位置（或使用默认）
4. 确认创建
5. 系统自动创建 `MainMenu.prefab`，包含配置好的Canvas

### 快速原型开发

使用此功能可以快速创建多个UI界面进行原型设计：
- 输入UI名称
- 一键创建
- 立即可在场景中使用

## 相关文件

- `UIManagerSettings.cs` - 配置数据
- `UITemplateGenerator.cs` - 模板生成器
- `UIManagementTab.cs` - UI管理主逻辑
- `UICreateDialog.cs` - 创建对话框
- `UIDeleteDialog.cs` - 删除对话框
- `Template/DefaultUITemplate.prefab` - 默认模板

