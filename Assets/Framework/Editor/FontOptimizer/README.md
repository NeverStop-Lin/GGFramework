# Unity 字体优化插件

## 📦 插件说明

将原本的 Node.js 字体优化工具改造为 Unity 编辑器插件，可以直接在 Unity 中使用。

提供了 **两个版本**：

### 1️⃣ FontOptimizerEditor.cs - 完整功能版 ⭐⭐⭐

**特点**:
- 调用原有的 font-edit 工具
- 功能完整（字体压缩）
- 支持 Excel、XML 等复杂格式
- 需要 Node.js 环境

**菜单**: `Tools → 字体优化工具`

**功能**:
- ✅ 扫描项目提取文字
- ✅ 压缩字体文件
- ✅ 图形化界面配置
- ✅ 实时日志输出

### 2️⃣ FontOptimizerWindow.cs - 纯C#版 ⭐⭐

**特点**:
- 纯 C# 实现
- 无需 Node.js
- 仅提取文字（不压缩字体）
- 轻量级

**菜单**: `Tools → 字体优化工具（纯C#版）`

**功能**:
- ✅ 扫描项目提取文字
- ✅ 导出字符列表
- ✅ 支持 C#、JSON、TXT、Prefab、Scene
- ❌ 不支持字体压缩（需手动使用其他工具）

---

## 🚀 使用方法

### 方法1: 使用完整功能版（推荐）

#### 前置条件
1. 安装 Node.js
2. 安装 font-edit 依赖：
```bash
cd Tools/font-edit
npm install
```

#### 使用步骤
1. Unity 菜单：`Tools → 字体优化工具`
2. 配置路径：
   - 扫描路径：项目路径（默认自动填充）
   - 原始字体：选择原始字体文件
   - 输出路径：Assets/Resources
3. 点击 **"开始优化字体"**
4. 等待完成，查看日志输出
5. 在输出路径找到优化后的字体

#### 界面预览
```
┌─────────────────────────────────────┐
│ 字体优化工具                         │
├─────────────────────────────────────┤
│ 自动扫描项目中的所有文字...          │
├─────────────────────────────────────┤
│ 配置                                │
│ 扫描路径: [___________] [浏览]      │
│ 原始字体: [___________] [浏览]      │
│ 输出路径: [___________] [浏览]      │
├─────────────────────────────────────┤
│        [  开始优化字体  ]            │
├─────────────────────────────────────┤
│ 日志输出                            │
│ ┌─────────────────────────────────┐│
│ │ [10:30:15] 开始优化字体...      ││
│ │ [10:30:16] 扫描 C# 文件...     ││
│ │ [10:30:18] 压缩字体文件...     ││
│ │ [10:30:20] 优化完成！          ││
│ └─────────────────────────────────┘│
├─────────────────────────────────────┤
│ [清空日志] [打开目录] [查看帮助]    │
└─────────────────────────────────────┘
```

---

### 方法2: 使用纯C#版（无需Node.js）

#### 使用步骤
1. Unity 菜单：`Tools → 字体优化工具（纯C#版）`
2. 配置路径：
   - 扫描路径：Assets 目录（默认）
   - 输出文件：检测到的字符.txt
3. 点击 **"开始扫描"**
4. 等待扫描完成
5. 点击 **"导出结果"** 或 **"复制到剪贴板"**
6. 使用导出的字符列表，手动使用其他工具压缩字体

#### 界面预览
```
┌─────────────────────────────────────┐
│ 字体优化工具 - 文字提取器            │
├─────────────────────────────────────┤
│ 纯C#实现，无需Node.js...            │
├─────────────────────────────────────┤
│ 配置                                │
│ 扫描路径: [___________] [浏览]      │
│ 输出文件: [___________] [浏览]      │
├─────────────────────────────────────┤
│ 检测到的字符数: 97                  │
│ 字符预览:                           │
│ 参数组为返回默认值索引超出范围...    │
├─────────────────────────────────────┤
│ [开始扫描] [导出结果] [复制到剪贴板] │
├─────────────────────────────────────┤
│ 日志输出                            │
│ ┌─────────────────────────────────┐│
│ │ [10:30:15] 开始扫描...         ││
│ │ [10:30:16] 扫描 C# 文件: 123个 ││
│ │ [10:30:17] 扫描完成！          ││
│ └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

---

## 📊 两个版本对比

| 功能 | 完整功能版 | 纯C#版 |
|------|----------|--------|
| 文字提取 | ✅ | ✅ |
| 字体压缩 | ✅ | ❌ |
| Excel支持 | ✅ | ❌ |
| XML解析 | ✅ | ❌ |
| C#代码 | ✅ | ✅ |
| Unity资源 | ✅ | ✅ |
| 需要Node.js | ✅ 需要 | ❌ 不需要 |
| 包体优化 | ⭐⭐⭐ | ⭐ |
| 使用难度 | 中等 | 简单 |

---

## 🎯 推荐使用场景

### 使用完整功能版
- ✅ 项目有 Excel 配置表
- ✅ 需要完整的字体压缩功能
- ✅ 团队有 Node.js 环境
- ✅ 追求最佳优化效果

### 使用纯C#版
- ✅ 不想安装 Node.js
- ✅ 只需要提取文字列表
- ✅ 使用其他字体工具压缩
- ✅ 快速查看项目使用了哪些字符

---

## 🔧 高级配置

### 自定义扫描规则

编辑 `FontOptimizerWindow.cs`，修改扫描逻辑：

```csharp
// 添加更多文件类型
private void ScanCustomFiles()
{
    var files = Directory.GetFiles(_sourcePath, "*.asset", SearchOption.AllDirectories);
    // 自定义处理逻辑
}
```

### 自定义过滤规则

```csharp
private void ExtractChinese(string text)
{
    foreach (var c in text)
    {
        // 自定义字符过滤条件
        if (c >= 0x4E00 && c <= 0x9FA5)  // 中文
        {
            _detectedChars.Add(c);
        }
        // 添加其他条件
        if (c >= 0x3000 && c <= 0x303F)  // 中文标点
        {
            _detectedChars.Add(c);
        }
    }
}
```

---

## ⚠️ 注意事项

### 完整功能版
1. **首次使用需要安装依赖**:
   ```bash
   cd Tools/font-edit
   npm install
   ```

2. **确保 Node.js 已安装**:
   - 下载：https://nodejs.org/
   - 验证：`node --version`

3. **路径配置**:
   - 扫描路径：使用绝对路径或相对路径
   - 字体路径：必须是 .ttf 或 .otf 文件
   - 输出路径：建议使用 Assets 下的路径

### 纯C#版
1. **功能限制**:
   - 只提取字符，不压缩字体
   - 不支持 Excel 解析
   - 不支持复杂的 XML 解析

2. **字体压缩**:
   - 导出字符列表后
   - 使用在线工具或其他软件压缩
   - 推荐：font-spider、fontmin

---

## 🐛 常见问题

### Q1: 完整功能版提示找不到 npm？
**A**: 
1. 确认已安装 Node.js
2. 重启 Unity Editor
3. 检查系统环境变量

### Q2: 优化后的字体显示方框？
**A**: 
1. 检查 `检测到的字符.txt`
2. 确认缺失的字符
3. 添加到 `default-text.txt`
4. 重新运行优化

### Q3: 纯C#版不支持 Excel？
**A**: 
纯C#版只提取文字，不解析 Excel。
如需支持，使用完整功能版。

### Q4: 可以在新项目中使用吗？
**A**: 
✅ 可以！复制这两个插件文件到新项目的 Editor 目录即可。

---

## 📦 文件结构

```
Framework/Editor/FontOptimizer/
├── FontOptimizerEditor.cs         # 完整功能版
├── FontOptimizerEditor.cs.meta
├── FontOptimizerWindow.cs         # 纯C#版
├── FontOptimizerWindow.cs.meta
└── README.md                       # 本文档
```

---

## 🚀 快速开始

### 5分钟上手

1. **打开 Unity**
2. **菜单**: `Tools → 字体优化工具`
3. **点击**: `开始优化字体`
4. **等待**: 完成后查看输出
5. **使用**: 将优化后的字体应用到项目

就是这么简单！ 🎉

---

## 📚 相关文档

- [Tools/工具说明文档.md](../../../../Tools/工具说明文档.md) - font-edit 详细说明
- [Client/Framework提取清单.md](../../../Framework提取清单.md) - 框架提取指南

---

## 💡 提示

**开发阶段**: 使用完整字体，方便测试  
**发布前**: 运行优化工具，减小包体  
**持续集成**: 集成到自动化构建流程

**祝你使用愉快！** ✨

