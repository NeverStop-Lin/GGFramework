# UI系统目录结构说明

> **路径**: Assets/Framework/Core/Systems/UI/  
> **更新时间**: 2025-10-26  
> **架构版本**: MonoBehaviour v2.0

---

## 📁 目录分类

### 一、核心层 Core/（4个文件）

#### 继承层次（MonoBehaviour架构）

```
MonoBehaviour
  └─ BaseUIBehaviour (抽象基类)
      └─ UGUIBaseUIBehaviour (UGUI实现)
          └─ 用户UI类 (如MainMenuUI)
```

| 文件 | 类型 | 职责 | 状态 |
|------|------|------|------|
| `BaseUIBehaviour.cs` | MonoBehaviour基类 | Pipeline管道、Unity生命周期、Attachment机制 | ✅ 活跃 |
| `UGUIBaseUIBehaviour.cs` | MonoBehaviour实现 | UGUI实现、组件绑定、事件管理 | ✅ 活跃 |
| `UIFactoryBehaviour.cs` | 工厂类 | MonoBehaviour工厂，从Prefab创建UI | ✅ 活跃 |
| `UiLifeCycle.cs` | 数据结构 | UI生命周期返回值（ShowTask/HideTask/Target） | ✅ 活跃 |

**说明**: 旧的普通类架构（BaseUI、UGUIBaseUI、UIFactory）已彻底移除。

---

### 三、配置系统（7个文件）

#### 配置相关
| 文件 | 职责 | 说明 |
|------|------|------|
| `UIConfig.cs` | UI配置类 | 定义资源路径、类型、缓存策略等 |
| `UIConfigMerger.cs` | 配置融合器 | 合并代码配置和运行时配置 |
| `UIManifest.cs` | 配置清单 | ScriptableObject，运行时配置管理 |
| `UIManifestManager.cs` | 清单管理器 | 加载和访问UIManifest |

#### 枚举定义
| 文件 | 枚举名 | 说明 |
|------|--------|------|
| `UIType.cs` | UIType | Main/Popup/Effect/Top |
| `UIAlignType.cs` | UIAlignType | Center/Top/Bottom |
| `UICacheStrategy.cs` | UICacheStrategy | AlwaysCache/NeverCache/LRU |
| `UIAnimationType.cs` | UIAnimationType | None/Fade/Scale/Slide/Custom |
| `UIState.cs` | UIState | Create/Show/Ready/Hide/Destroy |
| `UIRuntimeState.cs` | UIRuntimeState | Creating/Showing/Hidden/Destroyed |

---

### 四、管理器系统（5个文件）🆕

| 文件 | 职责 | 主要功能 |
|------|------|---------|
| `UICenter.cs` | UI管理中心 | 显示/隐藏/销毁、栈管理、预加载 |
| `UIInstanceManager.cs` | 实例管理器 | UI实例缓存、LRU淘汰、内存管理 |
| `UIStackManager.cs` | 栈管理器 | Push/Pop、返回功能、Raycast控制 |
| `UILayerManager.cs` | 层级管理器 | 自动分配sortingOrder（固定区间） |
| `UIStateManager.cs` | 状态管理器 | 状态追踪、状态持久化 |
| `UIRootManager.cs` | UIRoot管理器 | 自动创建UIRoot、UI挂载 |

---

### 五、Attachment系统（7个文件）

#### 核心Attachment（由BaseUI自动添加）
| 文件 | 职责 | 使用情况 |
|------|------|---------|
| `UIAttachment.cs` | Attachment基类 | 所有Attachment的基类 |
| `ActionUiAttachment.cs` | Action管理 | BaseUI自动添加 |
| `EmitLifeCycleUIAttachment.cs` | 生命周期事件 | BaseUI自动添加 |
| `SortUIAttachment.cs` | UI排序 | BaseUI自动添加 |

#### 可选Attachment（子类可添加）
| 文件 | 职责 | 使用情况 |
|------|------|---------|
| `ShowHideUiAttachment.cs` | 显示隐藏 | MainUI/PopupUI使用 |
| `MaskUIAttachment.cs` | 遮罩 | PopupUI使用 |
| `AlignUIAttachment.cs` | 对齐 | ⚠️ 空实现，暂时保留 |

---

### 六、Attachment系统（已分类到 Attachment/）

详见上文"需要保留的文件"部分。

---

### 七、扩展功能（1个目录）🆕

#### Extensions/
| 文件 | 职责 | 功能 |
|------|------|------|
| `UIBindingExtensions.cs` | 数据绑定扩展 | 8个绑定方法（BindText、BindNumber等） |

---

### 八、UI工具类（1个目录）

#### Utils/
| 文件 | 职责 |
|------|------|
| `CustomSprite.cs` | 自定义Sprite |
| `Label.cs` | 标签 |
| `Sprite.cs` | Sprite工具 |
| `Editor/CustomSpriteEditor.cs` | 自定义Sprite编辑器 |
| `Editor/SpriteEditor.cs` | Sprite编辑器 |

**说明**：这些是UI辅助工具，与核心系统分离。

---

## 📊 文件统计

### 按类型统计

| 类型 | 数量 | 目录位置 |
|------|------|---------|
| 核心层 | 4 | Core/ (BaseUIBehaviour、UGUIBaseUIBehaviour、UIFactoryBehaviour、UiLifeCycle) |
| 配置系统 | 10 | Config/ (Config、Manifest、6个枚举) |
| 管理器 | 6 | Managers/ (Center、Instance、Stack、Layer、State、Root) |
| Attachment | 7 | Attachment/ (各种UI行为扩展) |
| 扩展功能 | 1 | Extensions/ (数据绑定扩展) |
| UI工具 | 5 | Utils/ (Sprite相关工具) |

**总计**: 33个文件（不含.meta）

**说明**: 旧的普通类架构文件已彻底移除（BaseUI、UGUIBaseUI、UIFactory、MainUI、PopupUI）

### 按目录统计

| 目录 | 文件数 | 说明 |
|------|--------|------|
| Core/ | 4 | MonoBehaviour核心基类 + 工厂 + 数据结构 |
| Managers/ | 6 | 管理器系统 |
| Config/ | 10 | 配置和枚举 |
| Attachment/ | 7 | Attachment系统 |
| Extensions/ | 1 | 扩展功能 |
| Utils/ | 5 | 工具类 |
| **根目录** | **0** | **完全干净！** ✅
| ~~Deprecated/~~ | ~~已删除~~ | ~~旧代码已彻底清理~~ |

### 按状态统计

| 状态 | 数量 | 说明 |
|------|------|------|
| ✅ 活跃使用 | 33 | 所有文件均为活跃状态 |
| 🆕 MonoBehaviour架构 | 3 | BaseUIBehaviour、UGUIBaseUIBehaviour、UIFactoryBehaviour |
| ⚠️ 待定 | 1 | AlignUIAttachment（空实现） |

---

## ✅ 当前目录组织（MonoBehaviour架构）

目录已按功能重新组织，结构清晰，**根目录完全干净**！

```
Assets/Framework/Core/Systems/UI/
├─ Core/                          # 核心层（MonoBehaviour） ✅
│  ├─ BaseUIBehaviour.cs          (MonoBehaviour Pipeline基类)
│  ├─ UGUIBaseUIBehaviour.cs      (UGUI实现)
│  ├─ UIFactoryBehaviour.cs       (MonoBehaviour工厂)
│  └─ UiLifeCycle.cs              (生命周期返回值数据结构)
│
├─ Managers/                      # 管理器系统 ✅ 🆕
│  ├─ UICenter.cs                 (UI管理中心)
│  ├─ UIInstanceManager.cs        (实例管理)
│  ├─ UIStackManager.cs           (栈管理)
│  ├─ UILayerManager.cs           (层级管理)
│  ├─ UIStateManager.cs           (状态管理)
│  └─ UIRootManager.cs            (UIRoot管理)
│
├─ Config/                        # 配置系统 ✅ 🆕
│  ├─ UIConfig.cs                 (配置类)
│  ├─ UIConfigMerger.cs           (配置融合)
│  ├─ UIManifest.cs               (配置清单)
│  ├─ UIManifestManager.cs        (清单管理)
│  ├─ UIType.cs                   (UI类型枚举)
│  ├─ UIAlignType.cs              (对齐类型枚举)
│  ├─ UICacheStrategy.cs          (缓存策略枚举)
│  ├─ UIAnimationType.cs          (动画类型枚举)
│  ├─ UIState.cs                  (生命周期状态枚举)
│  └─ UIRuntimeState.cs           (运行时状态枚举)
│
├─ Attachment/                    # Attachment系统 ✅
│  ├─ UIAttachment.cs             (Attachment基类)
│  ├─ ActionUiAttachment.cs       (Action管理)
│  ├─ EmitLifeCycleUIAttachment.cs (生命周期事件)
│  ├─ SortUIAttachment.cs         (UI排序)
│  ├─ ShowHideUiAttachment.cs     (显示隐藏)
│  ├─ MaskUIAttachment.cs         (遮罩)
│  └─ AlignUIAttachment.cs        (对齐，空实现)
│
├─ Extensions/                    # 扩展功能 ✅ 🆕
│  └─ UIBindingExtensions.cs      (数据绑定扩展)
│
├─ Utils/                         # 工具类 ✅
│  ├─ CustomSprite.cs
│  ├─ Label.cs
│  ├─ Sprite.cs
│  └─ Editor/
│      ├─ CustomSpriteEditor.cs
│      └─ SpriteEditor.cs
│
└─ 目录结构说明.md                # 本文件
```

**根目录文件数**: 0个 ✅ **完全干净！**

---

## ✅ MonoBehaviour架构迁移完成

已成功完成从普通类到MonoBehaviour的架构升级！

**完成时间**: 2025-10-26  
**架构版本**: MonoBehaviour v2.0  
**旧代码清理**: 100%

### 迁移效果

**优势**：
- ✅ Unity标准MonoBehaviour架构
- ✅ Inspector可视化调试
- ✅ Unity生命周期完整支持
- ✅ 编译正常，无错误
- ✅ 旧代码彻底清除

**根目录文件**：0个 ✅ **完全干净！**

**目录统计**：
- Core/ - 4个文件（MonoBehaviour基类 + 工厂 + 数据结构）
- Managers/ - 6个文件
- Config/ - 10个文件
- Attachment/ - 7个文件
- Extensions/ - 1个文件
- Utils/ - 5个文件

**架构特点**：
- 100% MonoBehaviour架构
- UI类直接挂载到Prefab上
- 支持Unity所有生命周期钩子
- Inspector完全可视化

---

## 📋 MonoBehaviour架构文件清单

### Core/目录（4个文件）
- BaseUIBehaviour.cs - MonoBehaviour核心基类
- UGUIBaseUIBehaviour.cs - UGUI实现
- UIFactoryBehaviour.cs - MonoBehaviour工厂
- UiLifeCycle.cs - 生命周期数据结构

### Managers/目录（6个文件）
- UICenter.cs - UI管理中心
- UIInstanceManager.cs - 实例管理
- UIStackManager.cs - 栈管理
- UILayerManager.cs - 层级管理
- UIStateManager.cs - 状态管理
- UIRootManager.cs - UIRoot管理

### Config/目录（10个文件）
- UIConfig.cs - UI配置类
- UIConfigMerger.cs - 配置融合器
- UIManifest.cs - 配置清单
- UIManifestManager.cs - 清单管理器
- UIType.cs - UI类型枚举
- UIAlignType.cs - 对齐类型枚举
- UICacheStrategy.cs - 缓存策略枚举
- UIAnimationType.cs - 动画类型枚举
- UIState.cs - 生命周期状态枚举
- UIRuntimeState.cs - 运行时状态枚举

### Attachment/目录（7个文件）
- UIAttachment.cs - Attachment基类
- ActionUiAttachment.cs - Action管理
- EmitLifeCycleUIAttachment.cs - 生命周期事件
- SortUIAttachment.cs - UI排序
- ShowHideUiAttachment.cs - 显示隐藏
- MaskUIAttachment.cs - 遮罩
- AlignUIAttachment.cs - 对齐（空实现）

### Extensions/目录（1个文件）
- UIBindingExtensions.cs - 数据绑定扩展

### Utils/目录（5个文件）
- CustomSprite.cs
- Label.cs
- Sprite.cs
- Editor/CustomSpriteEditor.cs
- Editor/SpriteEditor.cs

**总计**: 33个文件（不含.meta）

**架构**: 100% MonoBehaviour，0% 普通类

