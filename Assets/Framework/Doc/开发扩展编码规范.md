# GGFramework å¼€å‘æ‰©å±•ç¼–ç è§„èŒƒ

> **ç‰ˆæœ¬**: v2.0.0  
> **æ›´æ–°æ—¥æœŸ**: 2024-01  
> **é€‚ç”¨èŒƒå›´**: GGFramework æ ¸å¿ƒæ¡†æ¶åŠæ‰©å±•æ¨¡å—å¼€å‘

---

## ğŸ“‹ ç›®å½•

1. [å‘½åè§„èŒƒ](#1-å‘½åè§„èŒƒ)
2. [ä»£ç ç»“æ„è§„èŒƒ](#2-ä»£ç ç»“æ„è§„èŒƒ)
3. [æ¶æ„è®¾è®¡è§„èŒƒ](#3-æ¶æ„è®¾è®¡è§„èŒƒ)
4. [æ ¸å¿ƒç³»ç»Ÿæ‰©å±•è§„èŒƒ](#4-æ ¸å¿ƒç³»ç»Ÿæ‰©å±•è§„èŒƒ)
5. [æ³¨é‡Šå’Œæ–‡æ¡£è§„èŒƒ](#5-æ³¨é‡Šå’Œæ–‡æ¡£è§„èŒƒ)
6. [æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
7. [ç¤ºä¾‹ä»£ç ](#7-ç¤ºä¾‹ä»£ç )

---

## 1. å‘½åè§„èŒƒ

### 1.1 ç±»å’Œæ¥å£å‘½å

#### è§„åˆ™
- **ç±»å**: PascalCaseï¼ˆå¸•æ–¯å¡å‘½åæ³•ï¼‰
- **æ¥å£å**: ä»¥ `I` å¼€å¤´ + PascalCase
- **æŠ½è±¡ç±»**: ä»¥ `Base` å¼€å¤´ï¼ˆå¦‚æœæ˜¯åŸºç±»ï¼‰
- **æ³›å‹ç±»**: æ˜ç¡®ç±»å‹å‚æ•°å«ä¹‰

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
// ç±»å‘½å
public class SoundModule { }
public class UICenter { }
public class ConfigCenter { }

// æ¥å£å‘½å
public interface IUI { }
public interface IObservers { }
public interface IStorage { }

// æŠ½è±¡ç±»å‘½å
public abstract class BaseUI { }
public abstract class BaseObserver<T> { }

// æ³›å‹ç±»å‘½å
public class ValueObserver<T> { }  // T è¡¨ç¤ºå€¼ç±»å‹
public class CacheObserver<TValue> { }  // TValue æ›´æ˜ç¡®
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```csharp
// ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–å°é©¼å³°
public class sound_module { }
public class uiCenter { }

// æ¥å£ä¸è¦å¿˜è®° I å‰ç¼€
public interface UI { }

// æŠ½è±¡ç±»å‘½åä¸æ¸…æ™°
public abstract class UIBase { }  // åº”è¯¥æ˜¯ BaseUI
```

### 1.2 æ–¹æ³•å‘½å

#### è§„åˆ™
- **å…¬å…±æ–¹æ³•**: PascalCase
- **ç§æœ‰æ–¹æ³•**: PascalCaseï¼ˆä¸ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€ï¼‰
- **ç”Ÿå‘½å‘¨æœŸæ–¹æ³•**: ä»¥ `On` å¼€å¤´
- **å¼‚æ­¥æ–¹æ³•**: ä»¥ `Async` ç»“å°¾ï¼ˆå¯é€‰ï¼‰

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
// å…¬å…±æ–¹æ³•
public void PlayMusic(string name) { }
public T Get<T>() where T : IConfig { }

// ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
protected virtual void OnCreate(params object[] args) { }
protected virtual void OnShow(params object[] args) { }
protected virtual void OnHide(params object[] args) { }
protected virtual void OnDestroy(params object[] args) { }

// å¼‚æ­¥æ–¹æ³•ï¼ˆä¸¤ç§é£æ ¼éƒ½å¯ä»¥ï¼‰
public async Task<object> DoCreate(params object[] args) { }
public async Task LoadAssetAsync() { }

// ç§æœ‰æ–¹æ³•
private void ConfigureAudioSource() { }
private object[] GetParameters(PipelineContext context) { }
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```csharp
// ä¸è¦ä½¿ç”¨å°é©¼å³°
public void playMusic() { }

// ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿
private void _configure_audio() { }

// ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸è¦é—æ¼ On å‰ç¼€
protected virtual void Create() { }  // åº”è¯¥æ˜¯ OnCreate
```

### 1.3 å­—æ®µå’Œå±æ€§å‘½å

#### è§„åˆ™
- **å…¬å…±å±æ€§**: PascalCase
- **ç§æœ‰å­—æ®µ**: ä»¥ `_` å¼€å¤´ + camelCase
- **å—ä¿æŠ¤å­—æ®µ**: ä»¥ `_` å¼€å¤´ + camelCaseï¼ˆå¯é€‰ï¼‰
- **å¸¸é‡**: UPPER_SNAKE_CASE æˆ– PascalCase
- **é™æ€å­—æ®µ**: PascalCase

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
public class SoundModule
{
    // ç§æœ‰å­—æ®µï¼šä¸‹åˆ’çº¿ + å°é©¼å³°
    private AudioSource _audioSource;
    private GameObject _soundObject;
    [Inject] private IObservers _observers;
    
    // å—ä¿æŠ¤å­—æ®µ
    protected T _value;
    protected UIState _uiState = UIState.None;
    
    // å…¬å…±å±æ€§ï¼šå¸•æ–¯å¡å‘½å
    public bool MusicSwitch { get; set; }
    public T Value { get; set; }
    public UIType UIType { get; set; }
    
    // é™æ€å­—æ®µ
    public static SoundModule Instance;
    
    // å¸¸é‡ï¼ˆä¸¤ç§é£æ ¼éƒ½å¯æ¥å—ï¼‰
    private const int MAX_POOL_SIZE = 100;
    private const string DefaultPath = "Resources/";
}
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```csharp
// ä¸è¦æ··ç”¨å‘½åé£æ ¼
private AudioSource audioSource;  // ç§æœ‰å­—æ®µåº”è¯¥åŠ ä¸‹åˆ’çº¿
public string _name;  // å…¬å…±å±æ€§ä¸åº”è¯¥æœ‰ä¸‹åˆ’çº¿
protected int m_count;  // ä¸ä½¿ç”¨ m_ å‰ç¼€ï¼Œä½¿ç”¨ _ å‰ç¼€
```

### 1.4 å‘½åç©ºé—´è§„èŒƒ

#### è§„åˆ™
- éµå¾ªç›®å½•ç»“æ„
- ä½¿ç”¨å…¬å¸/é¡¹ç›®å‰ç¼€
- å±‚æ¬¡æ¸…æ™°ï¼Œä¸è¶…è¿‡ 4 å±‚

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
namespace Framework.Infrastructure.Core.UI { }
namespace Framework.Infrastructure.Core.Observer { }
namespace Framework.Core.Config { }
namespace Framework.Modules.Sound { }
namespace Framework.Scripts { }
```

### 1.5 ç‰¹æ®Šå‘½åçº¦å®š

#### UI ç±»å‘½å
```csharp
// UI ç±»ä»¥ UI ç»“å°¾
public class MainMenuUI : UGUIBaseUI { }
public class SettingsUI : UGUIBaseUI { }
public class GameOverPopupUI : UGUIBaseUI { }

// Attachment ç±»ä»¥ Attachment ç»“å°¾
public class MaskUIAttachment : UIAttachment { }
public class AlignUIAttachment : UIAttachment { }
```

#### æ¨¡å—ç±»å‘½å
```csharp
// æ¨¡å—ç±»ä»¥ Module ç»“å°¾
public class SoundModule { }
public class CommonModule { }
public class ReportModule { }
```

#### è§‚å¯Ÿè€…ç±»å‘½å
```csharp
// è§‚å¯Ÿè€…ç±»ä»¥ Observer ç»“å°¾
public class ValueObserver<T> : BaseObserver<T> { }
public class CacheObserver<T> : BaseObserver<T> { }
```

---

## 2. ä»£ç ç»“æ„è§„èŒƒ

### 2.1 æ–‡ä»¶ç»„ç»‡

#### ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªç±»
```csharp
// âœ… æ­£ç¡®ï¼šæ¯ä¸ªæ–‡ä»¶åªåŒ…å«ä¸€ä¸ªä¸»è¦ç±»
// æ–‡ä»¶: SoundModule.cs
namespace Framework.Modules.Sound
{
    public class SoundModule
    {
        // ...
    }
}
```

#### ä¾‹å¤–ï¼šç›¸å…³çš„å°å‹ç±»
```csharp
// âœ… å¯æ¥å—ï¼šç›¸å…³çš„æšä¸¾æˆ–å°å‹è¾…åŠ©ç±»å¯ä»¥æ”¾åœ¨åŒä¸€æ–‡ä»¶
// æ–‡ä»¶: UIType.cs
namespace Framework.Infrastructure.Core.UI
{
    public enum UIType
    {
        Main,
        Popup,
        Effect,
        Top
    }
    
    public enum UIState
    {
        None,
        Create,
        Show,
        Ready,
        Hide,
        Destroy
    }
}
```

### 2.2 ç±»å†…éƒ¨ç»“æ„é¡ºåº

#### æ ‡å‡†é¡ºåºï¼ˆä½¿ç”¨ #region ç»„ç»‡ï¼‰
```csharp
public class ExampleClass : BaseClass
{
    #region å­—æ®µ
    
    // 1. å¸¸é‡
    private const int MAX_SIZE = 100;
    
    // 2. é™æ€å­—æ®µ
    public static ExampleClass Instance;
    
    // 3. ä¾èµ–æ³¨å…¥å­—æ®µ
    [Inject] private IUI _ui;
    [Inject] private IObservers _observers;
    
    // 4. ç§æœ‰å­—æ®µ
    private GameObject _gameObject;
    private int _count;
    
    // 5. å—ä¿æŠ¤å­—æ®µ
    protected UIState _state;
    
    #endregion
    
    #region å±æ€§
    
    // å…¬å…±å±æ€§
    public int Count { get; set; }
    public bool IsActive { get; private set; }
    
    #endregion
    
    #region æ„é€ å‡½æ•°
    
    public ExampleClass() { }
    
    #endregion
    
    #region ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    
    protected override void OnCreate(params object[] args) { }
    protected override void OnShow(params object[] args) { }
    protected override void OnHide(params object[] args) { }
    protected override void OnDestroy(params object[] args) { }
    
    #endregion
    
    #region å…¬å…±æ–¹æ³•
    
    public void DoSomething() { }
    
    #endregion
    
    #region å—ä¿æŠ¤æ–¹æ³•
    
    protected virtual void Initialize() { }
    
    #endregion
    
    #region ç§æœ‰æ–¹æ³•
    
    private void UpdateState() { }
    
    #endregion
}
```

### 2.3 å‘½åç©ºé—´å’Œ Using è¯­å¥

#### è§„åˆ™
1. æŒ‰å­—æ¯é¡ºåºæ’åˆ—
2. System å‘½åç©ºé—´ä¼˜å…ˆ
3. ç§»é™¤æœªä½¿ç”¨çš„ using

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Framework.Core.Interface;
using Framework.Infrastructure.Core.Observer;
using UnityEngine;
using Zenject;

namespace Framework.Modules.Sound
{
    public class SoundModule
    {
        // ...
    }
}
```

---

## 3. æ¶æ„è®¾è®¡è§„èŒƒ

### 3.1 ä¾èµ–æ³¨å…¥è§„èŒƒ

#### ä½¿ç”¨ Zenject æ³¨å…¥ä¾èµ–

**è§„åˆ™**ï¼š
- ä½¿ç”¨ `[Inject]` ç‰¹æ€§æ ‡è®°ä¾èµ–
- ä¼˜å…ˆä½¿ç”¨å­—æ®µæ³¨å…¥ï¼ˆç®€å•åœºæ™¯ï¼‰
- æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆéœ€è¦åˆå§‹åŒ–é€»è¾‘ï¼‰
- æ³¨å…¥æ¥å£è€Œéå…·ä½“å®ç°

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
public class SoundModule
{
    // å­—æ®µæ³¨å…¥ï¼ˆæ¨èç”¨äº Unity ç»„ä»¶ï¼‰
    [Inject] private IObservers _observers;
    [Inject] private IUI _ui;
    
    // æ³¨å…¥æ¥å£ï¼Œä¸æ˜¯å…·ä½“ç±»
    [Inject] private IStorage _storage;  // âœ… å¥½
    // [Inject] private StorageCenter _storage;  // âŒ ä¸æ¨è
    
    public void Initialize()
    {
        // ä½¿ç”¨æ³¨å…¥çš„ä¾èµ–
        var goldObserver = _observers.Value(100);
    }
}
```

#### æ„é€ å‡½æ•°æ³¨å…¥ç¤ºä¾‹
```csharp
public class ConfigCenter : IConfigs
{
    private readonly Dictionary<Type, object> _configs;
    
    // å¦‚æœéœ€è¦åœ¨æ„é€ æ—¶åˆå§‹åŒ–
    [Inject]
    public ConfigCenter()
    {
        _configs = new Dictionary<Type, object>();
    }
}
```

### 3.2 æ¥å£è®¾è®¡åŸåˆ™

#### æ¥å£éš”ç¦»åŸåˆ™
- æ¥å£åº”è¯¥å°è€Œä¸“æ³¨
- ä¸è¦åˆ›å»º"èƒ–æ¥å£"

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
// å¥½ï¼šæ¯ä¸ªæ¥å£èŒè´£å•ä¸€
public interface IUI
{
    Task<object> Show(Type uiType, params object[] args);
    Task<object> Hide(Type uiType, params object[] args);
}

public interface IObservers
{
    IValueObserver<T> Value<T>(T defaultValue);
    IValueObserver<T> Cache<T>(string key, T defaultValue);
}

public interface IStorage
{
    void Save(string key, object value);
    T Load<T>(string key);
}
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```csharp
// ä¸å¥½ï¼šæ¥å£åŒ…å«å¤ªå¤šä¸ç›¸å…³çš„èŒè´£
public interface IFramework
{
    void ShowUI();
    void PlaySound();
    void SaveData();
    void LoadConfig();
    // ... å¤ªå¤šèŒè´£
}
```

### 3.3 æŠ½è±¡ç±»ä½¿ç”¨è§„èŒƒ

#### ä½•æ—¶ä½¿ç”¨æŠ½è±¡ç±»
1. æä¾›é»˜è®¤å®ç°
2. å®šä¹‰æ¨¡æ¿æ–¹æ³•æ¨¡å¼
3. å…±äº«å…¬å…±ä»£ç 

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
public abstract class BaseUI : UIAttachment, IBaseUI
{
    // æä¾›å…¬å…±å­—æ®µå’Œå±æ€§
    [Inject] protected IUI Center;
    protected UIState uiState = UIState.None;
    public UIType UIType = UIType.Main;
    
    // æä¾›é»˜è®¤å®ç°
    public void Initialize()
    {
        // é€šç”¨åˆå§‹åŒ–é€»è¾‘
        OnAttachmentInitialize(_attachments);
    }
    
    // å®šä¹‰æ¨¡æ¿æ–¹æ³•
    public async Task<object> DoCreate(params object[] args)
    {
        return await ExecuteStatePipelineAsync(UIState.Create, args);
    }
    
    // å­ç±»å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³•
    public abstract int GetIndex();
    public abstract void SetIndex(int i);
    
    // å­ç±»å¯é€‰é‡å†™çš„è™šæ–¹æ³•
    protected virtual void OnCreate(params object[] args) { }
    protected virtual void OnShow(params object[] args) { }
}
```

### 3.4 ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### UI ç”Ÿå‘½å‘¨æœŸæ ‡å‡†æµç¨‹
```
Create â†’ Show â†’ Ready â†’ Hide â†’ Destroy
  â†“       â†“              â†“       â†“
åˆå§‹åŒ–   æ˜¾ç¤ºUI        å‡†å¤‡å®Œæˆ  éšè—    é”€æ¯èµ„æº
```

#### å®ç°ç”Ÿå‘½å‘¨æœŸ
```csharp
public class MyUI : UGUIBaseUI
{
    // 1. Createï¼šåˆ›å»ºUIå¯¹è±¡
    protected override void CreateUIObject()
    {
        var prefab = Resources.Load<GameObject>("UI/MyUI");
        UIObject = Object.Instantiate(prefab);
    }
    
    // 2. Showï¼šæ˜¾ç¤ºUIï¼Œæ¥æ”¶å‚æ•°
    protected override void OnShow(params object[] args)
    {
        base.OnShow(args);
        if (args.Length > 0)
        {
            // å¤„ç†ä¼ å…¥çš„å‚æ•°
        }
    }
    
    // 3. Hideï¼šéšè—UI
    protected override void OnHide(params object[] args)
    {
        base.OnHide(args);
        // æ¸…ç†ä¸´æ—¶çŠ¶æ€
    }
    
    // 4. Destroyï¼šé”€æ¯èµ„æº
    protected override void OnDestroy(params object[] args)
    {
        // å–æ¶ˆè®¢é˜…ã€é‡Šæ”¾èµ„æº
        base.OnDestroy(args);
    }
}
```

---

## 4. æ ¸å¿ƒç³»ç»Ÿæ‰©å±•è§„èŒƒ

### 4.1 UI ç³»ç»Ÿæ‰©å±•

#### åˆ›å»ºè‡ªå®šä¹‰ UI ç±»

**åŸºæœ¬æ­¥éª¤**ï¼š
1. ç»§æ‰¿ `UGUIBaseUI`
2. å®ç° `CreateUIObject()` æ–¹æ³•
3. é‡å†™éœ€è¦çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

#### å®Œæ•´ç¤ºä¾‹
```csharp
using Framework.Infrastructure.Core.UI;
using UnityEngine;
using UnityEngine.UI;

namespace MyProject.UI
{
    /// <summary>
    /// ä¸»èœå•UI
    /// </summary>
    public class MainMenuUI : UGUIBaseUI
    {
        // UIç»„ä»¶å¼•ç”¨
        private Button _startButton;
        private Button _settingsButton;
        private Text _titleText;
        
        /// <summary>
        /// åˆ›å»ºUIå¯¹è±¡ï¼ˆä»ResourcesåŠ è½½é¢„åˆ¶ä½“ï¼‰
        /// </summary>
        protected override void CreateUIObject()
        {
            // æ–¹å¼1ï¼šä» Resources åŠ è½½
            var prefab = Resources.Load<GameObject>("UI/MainMenu");
            UIObject = Object.Instantiate(prefab);
            
            // æ–¹å¼2ï¼šä» Addressables åŠ è½½ï¼ˆæ¨èï¼‰
            // var handle = Addressables.LoadAssetAsync<GameObject>("UI/MainMenu");
            // await handle.Task;
            // UIObject = Object.Instantiate(handle.Result);
            
            // è·å–ç»„ä»¶å¼•ç”¨
            _startButton = UIObject.transform.Find("StartButton").GetComponent<Button>();
            _settingsButton = UIObject.transform.Find("SettingsButton").GetComponent<Button>();
            _titleText = UIObject.transform.Find("Title").GetComponent<Text>();
        }
        
        /// <summary>
        /// æ˜¾ç¤ºUIæ—¶çš„é€»è¾‘
        /// </summary>
        protected override void OnShow(params object[] args)
        {
            base.OnShow(args);
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            _startButton.onClick.AddListener(OnStartButtonClick);
            _settingsButton.onClick.AddListener(OnSettingsButtonClick);
            
            // æ’­æ”¾æ˜¾ç¤ºåŠ¨ç”»
            // DOTween.To(() => 0f, x => Canvas.alpha = x, 1f, 0.3f);
        }
        
        /// <summary>
        /// éšè—UIæ—¶çš„é€»è¾‘
        /// </summary>
        protected override void OnHide(params object[] args)
        {
            base.OnHide(args);
            
            // ç§»é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬
            _startButton.onClick.RemoveListener(OnStartButtonClick);
            _settingsButton.onClick.RemoveListener(OnSettingsButtonClick);
        }
        
        /// <summary>
        /// å¼€å§‹æŒ‰é’®ç‚¹å‡»
        /// </summary>
        private void OnStartButtonClick()
        {
            // éšè—å½“å‰UI
            Hide();
            
            // æ˜¾ç¤ºæ¸¸æˆUI
            GridFramework.UI.Show<GameUI>();
        }
        
        /// <summary>
        /// è®¾ç½®æŒ‰é’®ç‚¹å‡»
        /// </summary>
        private void OnSettingsButtonClick()
        {
            GridFramework.UI.Show<SettingsUI>();
        }
    }
}
```

#### UI ç±»å‹å®šä¹‰

```csharp
public class MyMainUI : UGUIBaseUI
{
    public MyMainUI()
    {
        // è®¾ç½®UIç±»å‹
        UIType = UIType.Main;  // ä¸»ç•Œé¢ï¼ˆå…¨å±ï¼‰
        AlignType = UIAlignType.Center;  // å±…ä¸­å¯¹é½
    }
}

public class MyPopupUI : UGUIBaseUI
{
    public MyPopupUI()
    {
        UIType = UIType.Popup;  // å¼¹çª—
        AlignType = UIAlignType.Center;
    }
}
```

### 4.2 è§‚å¯Ÿè€…ç³»ç»Ÿæ‰©å±•

#### ä½¿ç”¨å†…ç½®è§‚å¯Ÿè€…

```csharp
public class PlayerDataManager
{
    [Inject] private IObservers _observers;
    
    private IValueObserver<int> _goldObserver;
    private IValueObserver<int> _levelObserver;
    
    public void Initialize()
    {
        // å€¼è§‚å¯Ÿè€…ï¼ˆä¸æŒä¹…åŒ–ï¼‰
        _goldObserver = _observers.Value(0);
        
        // ç¼“å­˜è§‚å¯Ÿè€…ï¼ˆæŒä¹…åŒ–åˆ°æœ¬åœ°ï¼‰
        _levelObserver = _observers.Cache("player_level", 1);
        
        // ç›‘å¬å˜åŒ–
        _goldObserver.OnChange.Add((newValue, oldValue) =>
        {
            Debug.Log($"é‡‘å¸å˜åŒ–: {oldValue} -> {newValue}");
            UpdateGoldUI(newValue);
        });
    }
    
    public void AddGold(int amount)
    {
        // ä¿®æ”¹å€¼ä¼šè‡ªåŠ¨è§¦å‘ç›‘å¬å™¨
        _goldObserver.Value += amount;
    }
}
```

#### åˆ›å»ºè‡ªå®šä¹‰è§‚å¯Ÿè€…

```csharp
using Framework.Infrastructure.Core.Observer;
using Framework.Core.Interface.Observer;

namespace MyProject.Data
{
    /// <summary>
    /// è‡ªå®šä¹‰è§‚å¯Ÿè€…ï¼šå¸¦æœ‰éªŒè¯é€»è¾‘çš„è§‚å¯Ÿè€…
    /// </summary>
    public class ValidatedObserver<T> : BaseObserver<T>, IValueObserver<T>
    {
        private T _value;
        private readonly Func<T, bool> _validator;
        
        public T Value
        {
            get => _value;
            set
            {
                // éªŒè¯æ–°å€¼
                if (_validator != null && !_validator(value))
                {
                    Debug.LogWarning($"å€¼éªŒè¯å¤±è´¥: {value}");
                    return;
                }
                
                T oldValue = _value;
                _value = value;
                Notify(_value, oldValue);
            }
        }
        
        public ValidatedObserver(T defaultValue, Func<T, bool> validator)
        {
            _value = defaultValue;
            _validator = validator;
        }
        
        public void Initialize(T value)
        {
            _value = value;
            OnChange.AutoInvoke(() => new object[] { Value, Value });
        }
    }
}
```

### 4.3 æ¨¡å—ç³»ç»Ÿæ‰©å±•

#### åˆ›å»ºè‡ªå®šä¹‰æ¨¡å—

**æ­¥éª¤**ï¼š
1. åˆ›å»ºæ¨¡å—ç±»
2. åœ¨ `ModuleInstaller.cs` ä¸­æ³¨å†Œ
3. åœ¨ `GridModules.cs` ä¸­æš´éœ²è®¿é—®æ¥å£

#### å®Œæ•´ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç½‘ç»œæ¨¡å—

**æ­¥éª¤ 1ï¼šåˆ›å»ºæ¨¡å—ç±»**
```csharp
using System;
using System.Threading.Tasks;
using Framework.Core.Interface;
using UnityEngine;
using UnityEngine.Networking;
using Zenject;

namespace Framework.Modules.Network
{
    /// <summary>
    /// ç½‘ç»œè¯·æ±‚æ¨¡å—
    /// </summary>
    public class NetworkModule
    {
        [Inject] private IObservers _observers;
        
        private string _baseUrl = "https://api.example.com";
        private IValueObserver<bool> _isConnected;
        
        /// <summary>
        /// æ˜¯å¦å·²è¿æ¥
        /// </summary>
        public bool IsConnected
        {
            get
            {
                if (_isConnected == null)
                {
                    _isConnected = _observers.Value(true);
                }
                return _isConnected.Value;
            }
            private set => _isConnected.Value = value;
        }
        
        /// <summary>
        /// å‘é€ GET è¯·æ±‚
        /// </summary>
        public async Task<string> GetAsync(string endpoint)
        {
            string url = $"{_baseUrl}/{endpoint}";
            
            using (UnityWebRequest request = UnityWebRequest.Get(url))
            {
                await request.SendWebRequest();
                
                if (request.result == UnityWebRequest.Result.Success)
                {
                    return request.downloadHandler.text;
                }
                else
                {
                    Debug.LogError($"è¯·æ±‚å¤±è´¥: {request.error}");
                    return null;
                }
            }
        }
        
        /// <summary>
        /// å‘é€ POST è¯·æ±‚
        /// </summary>
        public async Task<string> PostAsync(string endpoint, string jsonData)
        {
            string url = $"{_baseUrl}/{endpoint}";
            
            using (UnityWebRequest request = new UnityWebRequest(url, "POST"))
            {
                byte[] bodyRaw = System.Text.Encoding.UTF8.GetBytes(jsonData);
                request.uploadHandler = new UploadHandlerRaw(bodyRaw);
                request.downloadHandler = new DownloadHandlerBuffer();
                request.SetRequestHeader("Content-Type", "application/json");
                
                await request.SendWebRequest();
                
                if (request.result == UnityWebRequest.Result.Success)
                {
                    return request.downloadHandler.text;
                }
                else
                {
                    Debug.LogError($"è¯·æ±‚å¤±è´¥: {request.error}");
                    return null;
                }
            }
        }
    }
}
```

**æ­¥éª¤ 2ï¼šåœ¨ ModuleInstaller ä¸­æ³¨å†Œ**
```csharp
using Framework.Modules.Sound;
using Framework.Modules.Network;  // æ·»åŠ å¼•ç”¨
using UnityEngine;
using Zenject;

[CreateAssetMenu(fileName = "ModuleInstaller", menuName = "Installers/ModuleInstaller")]
public class ModuleInstaller : ScriptableObjectInstaller<ModuleInstaller>
{
    public override void InstallBindings()
    {
        Container.Bind<SoundModule>().AsSingle();
        Container.Bind<NetworkModule>().AsSingle();  // æ³¨å†Œæ¨¡å—
    }
}
```

**æ­¥éª¤ 3ï¼šåœ¨ GridModules ä¸­æš´éœ²**
```csharp
using Framework.Modules.Sound;
using Framework.Modules.Network;  // æ·»åŠ å¼•ç”¨
using UnityEngine;
using Zenject;

namespace Framework.Scripts
{
    public class GridModules : MonoBehaviour
    {
        public static GridModules Instance;
        
        public static SoundModule Sound => Instance._sound;
        public static NetworkModule Network => Instance._network;  // æš´éœ²æ¥å£
        
        [Inject] private SoundModule _sound;
        [Inject] private NetworkModule _network;  // æ³¨å…¥æ¨¡å—
        
        void Awake() { Instance = this; }
    }
}
```

**æ­¥éª¤ 4ï¼šä½¿ç”¨æ¨¡å—**
```csharp
public class GameController : MonoBehaviour
{
    async void Start()
    {
        // ä½¿ç”¨ç½‘ç»œæ¨¡å—
        string response = await GridModules.Network.GetAsync("users/profile");
        Debug.Log($"æœåŠ¡å™¨å“åº”: {response}");
    }
}
```

### 4.4 Attachment ç³»ç»Ÿæ‰©å±•

#### åˆ›å»ºè‡ªå®šä¹‰ UI Attachment

Attachment ç”¨äºä¸º UI æ·»åŠ å¯é‡ç”¨çš„è¡Œä¸ºï¼ˆå¦‚åŠ¨ç”»ã€é®ç½©ã€å¯¹é½ç­‰ï¼‰ã€‚

#### ç¤ºä¾‹ï¼šåˆ›å»º UI åŠ¨ç”» Attachment

```csharp
using System.Threading.Tasks;
using Framework.Infrastructure.Core.UI.Attachment;
using Framework.Core.Utils.Pipeline;
using UnityEngine;
using DG.Tweening;  // éœ€è¦ DOTween æ’ä»¶

namespace MyProject.UI.Attachment
{
    /// <summary>
    /// UIæ˜¾ç¤º/éšè—åŠ¨ç”»é™„ä»¶
    /// ä½¿ç”¨ DOTween å®ç°æ·¡å…¥æ·¡å‡ºæ•ˆæœ
    /// </summary>
    public class FadeAnimationAttachment : UIAttachment
    {
        private float _duration = 0.3f;
        private CanvasGroup _canvasGroup;
        
        /// <summary>
        /// æ˜¾ç¤ºå‰ï¼šæ’­æ”¾æ·¡å…¥åŠ¨ç”»
        /// </summary>
        protected override async Task OnBeforeShow(PipelineContext context)
        {
            EnsureCanvasGroup();
            
            // ä»é€æ˜æ·¡å…¥
            _canvasGroup.alpha = 0f;
            await _canvasGroup.DOFade(1f, _duration).AsyncWaitForCompletion();
        }
        
        /// <summary>
        /// éšè—å‰ï¼šæ’­æ”¾æ·¡å‡ºåŠ¨ç”»
        /// </summary>
        protected override async Task OnBeforeHide(PipelineContext context)
        {
            EnsureCanvasGroup();
            
            // æ·¡å‡ºåˆ°é€æ˜
            await _canvasGroup.DOFade(0f, _duration).AsyncWaitForCompletion();
        }
        
        /// <summary>
        /// ç¡®ä¿æœ‰ CanvasGroup ç»„ä»¶
        /// </summary>
        private void EnsureCanvasGroup()
        {
            if (_canvasGroup == null)
            {
                var ui = Target as UGUIBaseUI;
                if (ui != null && ui.Canvas != null)
                {
                    _canvasGroup = ui.Canvas.gameObject.GetComponent<CanvasGroup>();
                    if (_canvasGroup == null)
                    {
                        _canvasGroup = ui.Canvas.gameObject.AddComponent<CanvasGroup>();
                    }
                }
            }
        }
    }
}
```

#### åœ¨ UI ä¸­ä½¿ç”¨ Attachment

```csharp
using System.Collections.Generic;
using Framework.Infrastructure.Core.UI;
using Framework.Infrastructure.Core.UI.Attachment;
using MyProject.UI.Attachment;

public class MyAnimatedUI : UGUIBaseUI
{
    /// <summary>
    /// æ·»åŠ è‡ªå®šä¹‰ Attachment
    /// </summary>
    protected override void OnAttachmentInitialize(List<UIAttachment> attachments)
    {
        base.OnAttachmentInitialize(attachments);
        
        // æ·»åŠ æ·¡å…¥æ·¡å‡ºåŠ¨ç”»
        attachments.Add(new FadeAnimationAttachment());
        
        // å¯ä»¥æ·»åŠ å¤šä¸ª Attachment
        // attachments.Add(new ScaleAnimationAttachment());
        // attachments.Add(new CustomMaskAttachment());
    }
    
    protected override void CreateUIObject()
    {
        var prefab = Resources.Load<GameObject>("UI/MyAnimatedUI");
        UIObject = Object.Instantiate(prefab);
    }
}
```

---

## 5. æ³¨é‡Šå’Œæ–‡æ¡£è§„èŒƒ

### 5.1 XML æ–‡æ¡£æ³¨é‡Š

#### å…¬å…± API å¿…é¡»æ·»åŠ æ³¨é‡Š

```csharp
/// <summary>
/// éŸ³æ•ˆç®¡ç†æ¨¡å—
/// æä¾›èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆçš„æ’­æ”¾åŠŸèƒ½
/// </summary>
public class SoundModule
{
    /// <summary>
    /// æ’­æ”¾èƒŒæ™¯éŸ³ä¹
    /// </summary>
    /// <param name="name">éŸ³ä¹æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</param>
    /// <remarks>
    /// éŸ³ä¹æ–‡ä»¶åº”æ”¾ç½®åœ¨ Resources/Sound/ ç›®å½•ä¸‹
    /// </remarks>
    /// <example>
    /// <code>
    /// GridModules.Sound.PlayMusic("bgm_main");
    /// </code>
    /// </example>
    public void PlayMusic(string name)
    {
        var clip = Resources.Load<AudioClip>($"Sound/{name}");
        PlayMusic(clip);
    }
    
    /// <summary>
    /// æ’­æ”¾éŸ³æ•ˆ
    /// </summary>
    /// <param name="clip">éŸ³æ•ˆå‰ªè¾‘</param>
    public void PlayEffect(AudioClip clip)
    {
        if (!EffectSwitch) return;
        _audioSource.PlayOneShot(clip);
    }
}
```

#### æ³¨é‡Šæ ‡ç­¾ä½¿ç”¨æŒ‡å—

```csharp
/// <summary>ç±»æˆ–æ–¹æ³•çš„ç®€è¦è¯´æ˜</summary>
/// <param name="å‚æ•°å">å‚æ•°è¯´æ˜</param>
/// <returns>è¿”å›å€¼è¯´æ˜</returns>
/// <exception cref="å¼‚å¸¸ç±»å‹">å¼‚å¸¸è¯´æ˜</exception>
/// <remarks>å¤‡æ³¨ä¿¡æ¯ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰</remarks>
/// <example>ä½¿ç”¨ç¤ºä¾‹</example>
/// <seealso cref="ç›¸å…³ç±»æˆ–æ–¹æ³•"/>
```

### 5.2 ä»£ç æ³¨é‡Šè§„èŒƒ

#### å¤æ‚é€»è¾‘å¿…é¡»æ³¨é‡Š

```csharp
public async Task<object> DoCreate(params object[] args)
{
    // åˆ›å»ºç®¡é“ä¸Šä¸‹æ–‡ï¼Œä¼ é€’å‚æ•°å’Œç›®æ ‡å¯¹è±¡
    var context = new PipelineContext
    {
        Data =
        {
            ["params"] = args,
            ["target"] = this
        }
    };
    
    // ä¿å­˜ä¸Šä¸‹æ–‡ä»¥ä¾›åç»­ä½¿ç”¨
    _pipelineContext[UIState.Create] = context;
    
    // æ‰§è¡Œåˆ›å»ºç®¡é“ä¸­çš„æ‰€æœ‰ä¸­é—´ä»¶
    if (_uiPipelines.TryGetValue(UIState.Create, out var pipeline))
    {
        await pipeline.ExecuteAsync(context);
    }
    
    return context.Result;
}
```

#### åŒºåŸŸæ ‡è®°ä½¿ç”¨

```csharp
public class MyClass
{
    #region å­—æ®µ
    
    private int _count;
    
    #endregion
    
    #region å±æ€§
    
    public int Count { get; set; }
    
    #endregion
    
    #region å…¬å…±æ–¹æ³•
    
    public void DoSomething() { }
    
    #endregion
    
    #region ç§æœ‰æ–¹æ³•
    
    private void Initialize() { }
    
    #endregion
}
```

### 5.3 TODO æ³¨é‡Š

```csharp
// TODO: æ·»åŠ èµ„æºç¼“å­˜æœºåˆ¶
// FIXME: ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜
// HACK: ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦é‡æ„
// NOTE: æ³¨æ„è¿™é‡Œçš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 async/await ä½¿ç”¨è§„èŒƒ

#### è§„åˆ™
1. å¼‚æ­¥æ–¹æ³•è¿”å› `Task` æˆ– `Task<T>`
2. ä½¿ç”¨ `await` ç­‰å¾…å¼‚æ­¥æ“ä½œ
3. é¿å… `async void`ï¼ˆé™¤äº†äº‹ä»¶å¤„ç†ï¼‰
4. ä½¿ç”¨ `ConfigureAwait(false)` ï¼ˆé Unity ä¸»çº¿ç¨‹ï¼‰

#### âœ… æ­£ç¡®ç¤ºä¾‹
```csharp
// å¼‚æ­¥åŠ è½½èµ„æº
public async Task<GameObject> LoadUIAsync(string path)
{
    var handle = Addressables.LoadAssetAsync<GameObject>(path);
    await handle.Task;
    return handle.Result;
}

// å¼‚æ­¥æ‰§è¡Œç®¡é“
private async Task<object> ExecuteStatePipelineAsync(UIState state, object[] args)
{
    var context = new PipelineContext { /* ... */ };
    
    if (_uiPipelines.TryGetValue(state, out var pipeline))
    {
        await pipeline.ExecuteAsync(context);
    }
    
    return context.Result;
}

// ä½¿ç”¨å¼‚æ­¥æ–¹æ³•
public async void Start()  // Unity ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯ä»¥æ˜¯ async void
{
    await LoadUIAsync("UI/MainMenu");
}
```

#### âŒ é”™è¯¯ç¤ºä¾‹
```csharp
// ä¸è¦é˜»å¡å¼‚æ­¥æ–¹æ³•
public void LoadUI()
{
    var task = LoadUIAsync("UI/MainMenu");
    task.Wait();  // âŒ ä¼šé˜»å¡ä¸»çº¿ç¨‹
}

// ä¸è¦å¿˜è®° await
public async Task DoSomething()
{
    LoadUIAsync("UI/MainMenu");  // âŒ å¿˜è®° awaitï¼Œæ–¹æ³•ä¸ä¼šç­‰å¾…å®Œæˆ
}
```

### 6.2 Pipeline æ¨¡å¼ä½¿ç”¨

Pipeline æ¨¡å¼ç”¨äºå®ç°å¯æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

#### ç†è§£ Pipeline

```
è¯·æ±‚ â†’ ä¸­é—´ä»¶1 â†’ ä¸­é—´ä»¶2 â†’ ä¸­é—´ä»¶3 â†’ å“åº”
        â†“          â†“          â†“
      Before     Before     Before
        â†“          â†“          â†“
      After      After      After
```

#### ä½¿ç”¨ç¤ºä¾‹

```csharp
// åˆ›å»ºç®¡é“
var pipeline = new AsyncPipeline();

// æ·»åŠ ä¸­é—´ä»¶
pipeline.AddMiddleware(async (context, next) =>
{
    Debug.Log("Before step 1");
    await next();
    Debug.Log("After step 1");
});

pipeline.AddMiddleware(async (context, next) =>
{
    Debug.Log("Before step 2");
    await next();
    Debug.Log("After step 2");
});

// æ‰§è¡Œç®¡é“
await pipeline.ExecuteAsync(new PipelineContext());

// è¾“å‡ºé¡ºåºï¼š
// Before step 1
// Before step 2
// After step 2
// After step 1
```

### 6.3 èµ„æºç®¡ç†

#### ä½¿ç”¨ Addressablesï¼ˆæ¨èï¼‰

```csharp
using UnityEngine.AddressableAssets;
using UnityEngine.ResourceManagement.AsyncOperations;

public class ResourceManager
{
    // åŠ è½½èµ„æº
    public async Task<T> LoadAssetAsync<T>(string address) where T : Object
    {
        var handle = Addressables.LoadAssetAsync<T>(address);
        await handle.Task;
        
        if (handle.Status == AsyncOperationStatus.Succeeded)
        {
            return handle.Result;
        }
        
        Debug.LogError($"èµ„æºåŠ è½½å¤±è´¥: {address}");
        return null;
    }
    
    // é‡Šæ”¾èµ„æº
    public void ReleaseAsset(Object asset)
    {
        Addressables.Release(asset);
    }
}
```

#### Resources åŠ è½½ï¼ˆç®€å•åœºæ™¯ï¼‰

```csharp
public class SimpleResourceLoader
{
    // åŒæ­¥åŠ è½½
    public T Load<T>(string path) where T : Object
    {
        return Resources.Load<T>(path);
    }
    
    // å¼‚æ­¥åŠ è½½
    public async Task<T> LoadAsync<T>(string path) where T : Object
    {
        var request = Resources.LoadAsync<T>(path);
        
        while (!request.isDone)
        {
            await Task.Yield();
        }
        
        return request.asset as T;
    }
}
```

### 6.4 æ€§èƒ½ä¼˜åŒ–

#### å¯¹è±¡æ± æ¨¡å¼

```csharp
using System.Collections.Generic;
using UnityEngine;

public class ObjectPool<T> where T : Component
{
    private readonly T _prefab;
    private readonly Queue<T> _pool = new Queue<T>();
    private readonly Transform _parent;
    
    public ObjectPool(T prefab, int initialSize = 10, Transform parent = null)
    {
        _prefab = prefab;
        _parent = parent;
        
        // é¢„åˆ›å»ºå¯¹è±¡
        for (int i = 0; i < initialSize; i++)
        {
            var obj = Object.Instantiate(_prefab, _parent);
            obj.gameObject.SetActive(false);
            _pool.Enqueue(obj);
        }
    }
    
    /// <summary>
    /// ä»æ± ä¸­è·å–å¯¹è±¡
    /// </summary>
    public T Get()
    {
        T obj;
        
        if (_pool.Count > 0)
        {
            obj = _pool.Dequeue();
        }
        else
        {
            obj = Object.Instantiate(_prefab, _parent);
        }
        
        obj.gameObject.SetActive(true);
        return obj;
    }
    
    /// <summary>
    /// å½’è¿˜å¯¹è±¡åˆ°æ± ä¸­
    /// </summary>
    public void Return(T obj)
    {
        obj.gameObject.SetActive(false);
        _pool.Enqueue(obj);
    }
}
```

#### é¿å…é¢‘ç¹çš„ GetComponent

```csharp
// âŒ ä¸å¥½ï¼šæ¯æ¬¡éƒ½è°ƒç”¨ GetComponent
void Update()
{
    GetComponent<Rigidbody>().velocity = Vector3.forward;
}

// âœ… å¥½ï¼šç¼“å­˜ç»„ä»¶å¼•ç”¨
private Rigidbody _rigidbody;

void Start()
{
    _rigidbody = GetComponent<Rigidbody>();
}

void Update()
{
    _rigidbody.velocity = Vector3.forward;
}
```

#### ä½¿ç”¨ StringBuilder æ‹¼æ¥å­—ç¬¦ä¸²

```csharp
using System.Text;

// âŒ ä¸å¥½ï¼šé¢‘ç¹å­—ç¬¦ä¸²æ‹¼æ¥
string result = "";
for (int i = 0; i < 1000; i++)
{
    result += i.ToString();
}

// âœ… å¥½ï¼šä½¿ç”¨ StringBuilder
var sb = new StringBuilder();
for (int i = 0; i < 1000; i++)
{
    sb.Append(i);
}
string result = sb.ToString();
```

---

## 7. ç¤ºä¾‹ä»£ç 

### 7.1 å®Œæ•´çš„ UI æ‰©å±•ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å•†åº— UI å®ç°ç¤ºä¾‹ï¼Œå±•ç¤ºäº†æœ€ä½³å®è·µã€‚

```csharp
using System.Collections.Generic;
using Framework.Infrastructure.Core.UI;
using Framework.Infrastructure.Core.UI.Attachment;
using Framework.Core.Interface;
using UnityEngine;
using UnityEngine.UI;
using Zenject;

namespace MyProject.UI
{
    /// <summary>
    /// å•†åº—UI
    /// å±•ç¤ºå•†å“åˆ—è¡¨ï¼Œæ”¯æŒè´­ä¹°åŠŸèƒ½
    /// </summary>
    public class ShopUI : UGUIBaseUI
    {
        #region ä¾èµ–æ³¨å…¥
        
        [Inject] private IObservers _observers;
        [Inject] private IConfigs _configs;
        
        #endregion
        
        #region UIç»„ä»¶
        
        private Button _closeButton;
        private Button _refreshButton;
        private Transform _itemContainer;
        private Text _goldText;
        
        #endregion
        
        #region æ•°æ®
        
        private IValueObserver<int> _goldObserver;
        private List<ShopItemConfig> _shopItems;
        
        #endregion
        
        #region æ„é€ å‡½æ•°
        
        public ShopUI()
        {
            UIType = UIType.Popup;  // å¼¹çª—ç±»å‹
            AlignType = UIAlignType.Center;  // å±…ä¸­æ˜¾ç¤º
        }
        
        #endregion
        
        #region ç”Ÿå‘½å‘¨æœŸ
        
        /// <summary>
        /// åˆ›å»ºUIå¯¹è±¡
        /// </summary>
        protected override void CreateUIObject()
        {
            // åŠ è½½é¢„åˆ¶ä½“
            var prefab = Resources.Load<GameObject>("UI/ShopUI");
            UIObject = Object.Instantiate(prefab);
            
            // è·å–UIç»„ä»¶å¼•ç”¨
            _closeButton = UIObject.transform.Find("CloseButton").GetComponent<Button>();
            _refreshButton = UIObject.transform.Find("RefreshButton").GetComponent<Button>();
            _itemContainer = UIObject.transform.Find("ItemContainer");
            _goldText = UIObject.transform.Find("GoldText").GetComponent<Text>();
        }
        
        /// <summary>
        /// æ˜¾ç¤ºUI
        /// </summary>
        protected override void OnShow(params object[] args)
        {
            base.OnShow(args);
            
            // åˆå§‹åŒ–æ•°æ®
            InitializeData();
            
            // ç»‘å®šäº‹ä»¶
            _closeButton.onClick.AddListener(OnCloseButtonClick);
            _refreshButton.onClick.AddListener(OnRefreshButtonClick);
            
            // æ›´æ–°UI
            RefreshShopItems();
            UpdateGoldDisplay();
        }
        
        /// <summary>
        /// éšè—UI
        /// </summary>
        protected override void OnHide(params object[] args)
        {
            base.OnHide(args);
            
            // ç§»é™¤äº‹ä»¶ç›‘å¬
            _closeButton.onClick.RemoveListener(OnCloseButtonClick);
            _refreshButton.onClick.RemoveListener(OnRefreshButtonClick);
        }
        
        /// <summary>
        /// é”€æ¯UI
        /// </summary>
        protected override void OnDestroy(params object[] args)
        {
            // å–æ¶ˆè§‚å¯Ÿè€…è®¢é˜…
            if (_goldObserver != null)
            {
                _goldObserver.OnChange.Clear();
            }
            
            base.OnDestroy(args);
        }
        
        #endregion
        
        #region ç§æœ‰æ–¹æ³•
        
        /// <summary>
        /// åˆå§‹åŒ–æ•°æ®
        /// </summary>
        private void InitializeData()
        {
            // è·å–é‡‘å¸è§‚å¯Ÿè€…
            _goldObserver = _observers.Cache("player_gold", 0);
            
            // ç›‘å¬é‡‘å¸å˜åŒ–
            _goldObserver.OnChange.Add((newValue, oldValue) =>
            {
                UpdateGoldDisplay();
            });
            
            // åŠ è½½å•†åº—é…ç½®
            // var shopConfig = _configs.Get<ShopConfig>();
            // _shopItems = shopConfig.Items;
            
            // ä¸´æ—¶æ•°æ®
            _shopItems = new List<ShopItemConfig>();
        }
        
        /// <summary>
        /// åˆ·æ–°å•†åº—å•†å“åˆ—è¡¨
        /// </summary>
        private void RefreshShopItems()
        {
            // æ¸…ç©ºç°æœ‰å•†å“
            foreach (Transform child in _itemContainer)
            {
                Object.Destroy(child.gameObject);
            }
            
            // åˆ›å»ºå•†å“UI
            foreach (var item in _shopItems)
            {
                CreateShopItem(item);
            }
        }
        
        /// <summary>
        /// åˆ›å»ºå•ä¸ªå•†å“UI
        /// </summary>
        private void CreateShopItem(ShopItemConfig config)
        {
            var itemPrefab = Resources.Load<GameObject>("UI/ShopItem");
            var itemObj = Object.Instantiate(itemPrefab, _itemContainer);
            
            // è®¾ç½®å•†å“ä¿¡æ¯
            var itemUI = itemObj.GetComponent<ShopItemUI>();
            itemUI.SetData(config);
            
            // ç»‘å®šè´­ä¹°æŒ‰é’®
            itemUI.OnBuyClick = () => OnBuyItem(config);
        }
        
        /// <summary>
        /// æ›´æ–°é‡‘å¸æ˜¾ç¤º
        /// </summary>
        private void UpdateGoldDisplay()
        {
            _goldText.text = $"é‡‘å¸: {_goldObserver.Value}";
        }
        
        #endregion
        
        #region äº‹ä»¶å¤„ç†
        
        /// <summary>
        /// å…³é—­æŒ‰é’®ç‚¹å‡»
        /// </summary>
        private void OnCloseButtonClick()
        {
            Hide();
        }
        
        /// <summary>
        /// åˆ·æ–°æŒ‰é’®ç‚¹å‡»
        /// </summary>
        private void OnRefreshButtonClick()
        {
            RefreshShopItems();
        }
        
        /// <summary>
        /// è´­ä¹°å•†å“
        /// </summary>
        private void OnBuyItem(ShopItemConfig item)
        {
            // æ£€æŸ¥é‡‘å¸æ˜¯å¦è¶³å¤Ÿ
            if (_goldObserver.Value < item.Price)
            {
                Debug.Log("é‡‘å¸ä¸è¶³");
                // æ˜¾ç¤ºæç¤º
                return;
            }
            
            // æ‰£é™¤é‡‘å¸
            _goldObserver.Value -= item.Price;
            
            // æ·»åŠ ç‰©å“åˆ°èƒŒåŒ…
            // GridModules.Inventory.AddItem(item.ItemId, item.Count);
            
            Debug.Log($"è´­ä¹°æˆåŠŸ: {item.Name}");
        }
        
        #endregion
        
        #region æ·»åŠ è‡ªå®šä¹‰ Attachment
        
        protected override void OnAttachmentInitialize(List<UIAttachment> attachments)
        {
            base.OnAttachmentInitialize(attachments);
            
            // æ·»åŠ é®ç½©ï¼ˆç‚¹å‡»èƒŒæ™¯å…³é—­ï¼‰
            attachments.Add(new MaskUIAttachment());
            
            // å¯ä»¥æ·»åŠ æ›´å¤š Attachment
            // attachments.Add(new FadeAnimationAttachment());
        }
        
        #endregion
    }
    
    #region è¾…åŠ©ç±»
    
    /// <summary>
    /// å•†åº—å•†å“é…ç½®
    /// </summary>
    public class ShopItemConfig
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public int Price { get; set; }
        public int ItemId { get; set; }
        public int Count { get; set; }
    }
    
    /// <summary>
    /// å•†åº—å•†å“UIç»„ä»¶
    /// </summary>
    public class ShopItemUI : MonoBehaviour
    {
        public System.Action OnBuyClick;
        
        private Text _nameText;
        private Text _priceText;
        private Button _buyButton;
        
        void Awake()
        {
            _nameText = transform.Find("Name").GetComponent<Text>();
            _priceText = transform.Find("Price").GetComponent<Text>();
            _buyButton = transform.Find("BuyButton").GetComponent<Button>();
            
            _buyButton.onClick.AddListener(() => OnBuyClick?.Invoke());
        }
        
        public void SetData(ShopItemConfig config)
        {
            _nameText.text = config.Name;
            _priceText.text = config.Price.ToString();
        }
    }
    
    #endregion
}
```

### 7.2 å®Œæ•´çš„æ¨¡å—æ‰©å±•ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åˆ†ææ¨¡å—ç¤ºä¾‹ã€‚

```csharp
using System;
using System.Collections.Generic;
using Framework.Core.Interface;
using UnityEngine;
using Zenject;

namespace Framework.Modules.Analytics
{
    /// <summary>
    /// æ•°æ®åˆ†ææ¨¡å—
    /// ç”¨äºè®°å½•å’Œä¸ŠæŠ¥æ¸¸æˆäº‹ä»¶
    /// </summary>
    public class AnalyticsModule
    {
        #region ä¾èµ–æ³¨å…¥
        
        [Inject] private IStorage _storage;
        
        #endregion
        
        #region å­—æ®µ
        
        private readonly Dictionary<string, int> _eventCounts = new Dictionary<string, int>();
        private bool _isEnabled = true;
        
        #endregion
        
        #region å±æ€§
        
        /// <summary>
        /// æ˜¯å¦å¯ç”¨æ•°æ®ç»Ÿè®¡
        /// </summary>
        public bool IsEnabled
        {
            get => _isEnabled;
            set => _isEnabled = value;
        }
        
        #endregion
        
        #region æ„é€ å‡½æ•°
        
        public AnalyticsModule()
        {
            LoadEventCounts();
        }
        
        #endregion
        
        #region å…¬å…±æ–¹æ³•
        
        /// <summary>
        /// è®°å½•äº‹ä»¶
        /// </summary>
        /// <param name="eventName">äº‹ä»¶åç§°</param>
        /// <param name="parameters">äº‹ä»¶å‚æ•°</param>
        public void TrackEvent(string eventName, Dictionary<string, object> parameters = null)
        {
            if (!_isEnabled) return;
            
            Debug.Log($"[Analytics] äº‹ä»¶: {eventName}");
            
            // è®°å½•äº‹ä»¶æ¬¡æ•°
            if (!_eventCounts.ContainsKey(eventName))
            {
                _eventCounts[eventName] = 0;
            }
            _eventCounts[eventName]++;
            
            // ä¿å­˜åˆ°æœ¬åœ°
            SaveEventCounts();
            
            // ä¸ŠæŠ¥åˆ°æœåŠ¡å™¨
            // SendToServer(eventName, parameters);
        }
        
        /// <summary>
        /// è®°å½•å±å¹•è®¿é—®
        /// </summary>
        public void TrackScreen(string screenName)
        {
            TrackEvent($"screen_view", new Dictionary<string, object>
            {
                { "screen_name", screenName }
            });
        }
        
        /// <summary>
        /// è·å–äº‹ä»¶è§¦å‘æ¬¡æ•°
        /// </summary>
        public int GetEventCount(string eventName)
        {
            return _eventCounts.TryGetValue(eventName, out var count) ? count : 0;
        }
        
        /// <summary>
        /// æ¸…ç©ºç»Ÿè®¡æ•°æ®
        /// </summary>
        public void ClearData()
        {
            _eventCounts.Clear();
            SaveEventCounts();
        }
        
        #endregion
        
        #region ç§æœ‰æ–¹æ³•
        
        /// <summary>
        /// åŠ è½½äº‹ä»¶è®¡æ•°
        /// </summary>
        private void LoadEventCounts()
        {
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
            var data = _storage.Load<Dictionary<string, int>>("analytics_events");
            if (data != null)
            {
                foreach (var kvp in data)
                {
                    _eventCounts[kvp.Key] = kvp.Value;
                }
            }
        }
        
        /// <summary>
        /// ä¿å­˜äº‹ä»¶è®¡æ•°
        /// </summary>
        private void SaveEventCounts()
        {
            _storage.Save("analytics_events", _eventCounts);
        }
        
        #endregion
    }
}
```

### 7.3 é…ç½®ç³»ç»Ÿæ‰©å±•ç¤ºä¾‹

```csharp
using Framework.Core.Config;
using Framework.Core.Interface.Config;
using System.Collections.Generic;

namespace MyProject.Config
{
    /// <summary>
    /// å•†åº—é…ç½®
    /// </summary>
    public class ShopConfig : BaseConfig, IConfig
    {
        /// <summary>
        /// å•†åº—å•†å“åˆ—è¡¨
        /// </summary>
        public List<ShopItemData> Items { get; set; }
        
        /// <summary>
        /// åˆ·æ–°æ—¶é—´ï¼ˆç§’ï¼‰
        /// </summary>
        public int RefreshTime { get; set; }
        
        /// <summary>
        /// åŠ è½½é…ç½®
        /// </summary>
        public void Load()
        {
            // ä» Excel æˆ– JSON åŠ è½½é…ç½®
            Items = new List<ShopItemData>
            {
                new ShopItemData { Id = 1, Name = "é‡‘å¸åŒ…", Price = 100 },
                new ShopItemData { Id = 2, Name = "å®çŸ³åŒ…", Price = 500 }
            };
            
            RefreshTime = 3600;
        }
    }
    
    /// <summary>
    /// å•†åº—å•†å“æ•°æ®
    /// </summary>
    public class ShopItemData
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public int Price { get; set; }
    }
}
```

---

## ğŸ“Œ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨ä»£ç ç‰‡æ®µ

#### æ˜¾ç¤º UI
```csharp
GridFramework.UI.Show<MyUI>();
GridFramework.UI.Show<MyUI>("param1", 123);
```

#### ä½¿ç”¨è§‚å¯Ÿè€…
```csharp
var observer = GridFramework.Observer.Value(100);
observer.OnChange.Add((newVal, oldVal) => Debug.Log(newVal));
observer.Value = 200;
```

#### æ’­æ”¾éŸ³æ•ˆ
```csharp
GridModules.Sound.PlayMusic("bgm_main");
GridModules.Sound.PlayEffect("click");
```

#### è¯»å–é…ç½®
```csharp
var config = GridFramework.Config.Get<MyConfig>();
```

#### æœ¬åœ°å­˜å‚¨
```csharp
GridFramework.Storage.Save("key", value);
var data = GridFramework.Storage.Load<int>("key");
```

#### èµ„æºç®¡ç†
```csharp
// åŒæ­¥åŠ è½½
var prefab = GridFramework.Resource.Load<GameObject>("UI/MainMenu");

// å¼‚æ­¥åŠ è½½
var prefab = await GridFramework.Resource.LoadAsync<GameObject>("UI/MainMenu");

// å¸¦è¿›åº¦åŠ è½½
var prefab = await GridFramework.Resource.LoadAsync<GameObject>(
    "UI/MainMenu",
    progress => Debug.Log($"åŠ è½½è¿›åº¦: {progress * 100}%")
);

// é‡Šæ”¾èµ„æº
GridFramework.Resource.Release("UI/MainMenu");
```

#### å¯¹è±¡æ± 
```csharp
// åˆ›å»ºå¯¹è±¡æ± 
var pool = GridFramework.Pool.CreateGameObjectPool(bulletPrefab, minSize: 10);

// è·å–å¯¹è±¡
var bullet = pool.Spawn(position, rotation);

// å½’è¿˜å¯¹è±¡
pool.Despawn(bullet);

// ä¾¿æ·æ–¹æ³•
var obj = GridFramework.Pool.Spawn(prefab, position);
GridFramework.Pool.Despawn(obj);
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **ä¿æŒä¸€è‡´æ€§**: éµå¾ªæ¡†æ¶çš„å‘½åå’Œç»“æ„è§„èŒƒ
2. **ç®€æ´æ˜äº†**: ä»£ç åº”è¯¥æ˜“äºç†è§£å’Œç»´æŠ¤
3. **æ–‡æ¡£å®Œå–„**: å…¬å…± API å¿…é¡»æœ‰æ¸…æ™°çš„æ³¨é‡Š
4. **å¯æ‰©å±•æ€§**: ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ä¾¿äºæ‰©å±•
5. **æ€§èƒ½ä¼˜å…ˆ**: æ³¨æ„æ€§èƒ½ä¼˜åŒ–ï¼Œé¿å…å¸¸è§é™·é˜±

### å¼€å‘æµç¨‹

1. é˜…è¯»æœ¬è§„èŒƒæ–‡æ¡£
2. æŸ¥çœ‹ç¤ºä¾‹ä»£ç 
3. éµå¾ªå‘½åå’Œç»“æ„è§„èŒƒ
4. ç¼–å†™æ¸…æ™°çš„æ³¨é‡Š
5. è¿›è¡Œä»£ç å®¡æŸ¥

### æŒç»­æ”¹è¿›

æœ¬æ–‡æ¡£ä¼šéšç€æ¡†æ¶çš„å‘å±•ä¸æ–­æ›´æ–°ï¼Œæ¬¢è¿æå‡ºæ”¹è¿›å»ºè®®ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
**æœ€åæ›´æ–°**: 2024-01  
**ç»´æŠ¤è€…**: GGFramework Team

