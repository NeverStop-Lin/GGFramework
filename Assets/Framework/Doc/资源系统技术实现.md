# èµ„æºç³»ç»ŸæŠ€æœ¯å®ç°

> **ç‰ˆæœ¬**: v2.0.0  
> **é¢å‘**: æ¡†æ¶å­¦ä¹ è€…å’Œæ‰©å±•å¼€å‘è€…

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [æ ¸å¿ƒç±»è¯¦è§£](#æ ¸å¿ƒç±»è¯¦è§£)
3. [è®¾è®¡æ¨¡å¼åº”ç”¨](#è®¾è®¡æ¨¡å¼åº”ç”¨)
4. [å…³é”®æŠ€æœ¯ç‚¹](#å…³é”®æŠ€æœ¯ç‚¹)
5. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        GridFramework.Resource           â”‚  ç»Ÿä¸€è®¿é—®å…¥å£
â”‚             (IResource)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ResourceCenter                  â”‚  èµ„æºç®¡ç†ä¸­å¿ƒ
â”‚  - ç»Ÿä¸€æ¥å£å°è£…                          â”‚
â”‚  - ç¼“å­˜ç®¡ç†                              â”‚
â”‚  - åŠ è½½å™¨åˆ‡æ¢                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚
           â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResourceCache   â”‚  â”‚ IResourceLoader  â”‚  å¯æ’æ‹”åŠ è½½å™¨
â”‚  - LRU ç¼“å­˜     â”‚  â”‚                  â”‚
â”‚  - å¼•ç”¨è®¡æ•°      â”‚  â”œâ”€ AutoResourceLoader    (Auto)
â”‚  - è‡ªåŠ¨æ¸…ç†      â”‚  â”œâ”€ ResourcesLoader       (Resources)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€ AddressableLoader     (Addressables)
                         â””â”€ æ¸…å•æŸ¥è¯¢ï¼ˆ0msï¼‰
```

### è®¾è®¡ç†å¿µ

1. **æ¥å£æŠ½è±¡** - `IResource` å’Œ `IResourceLoader` åˆ†ç¦»å…³æ³¨ç‚¹
2. **ç­–ç•¥æ¨¡å¼** - å¯æ’æ‹”çš„åŠ è½½å™¨ï¼ˆResources / Addressables / Autoï¼‰
3. **ç¼“å­˜ä¼˜åŒ–** - LRU + å¼•ç”¨è®¡æ•°åŒé‡ç¼“å­˜ç­–ç•¥
4. **æ™ºèƒ½æ£€æµ‹** - åŸºäºæ¸…å•çš„é›¶å¼€é”€èµ„æºå®šä½

---

## æ ¸å¿ƒç±»è¯¦è§£

### 1. IResource æ¥å£

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Interface/IResource.cs`

**è®¾è®¡ç›®çš„**ï¼š
- å®šä¹‰ç»Ÿä¸€çš„èµ„æºç®¡ç†æ¥å£
- éš”ç¦»å®ç°ç»†èŠ‚
- ä¾¿äºä¾èµ–æ³¨å…¥

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```csharp
public interface IResource
{
    // åŠ è½½
    T Load<T>(string path) where T : UnityEngine.Object;
    Task<T> LoadAsync<T>(string path) where T : UnityEngine.Object;
    Task<T> LoadAsync<T>(string path, Action<float> onProgress) where T : UnityEngine.Object;
    
    // é¢„åŠ è½½
    Task PreloadAsync(params string[] paths);
    Task PreloadAsync(Action<float> onProgress, params string[] paths);
    
    // é‡Šæ”¾
    void Release(string path);
    void Release(UnityEngine.Object asset);
    void ReleaseUnused();
    void ClearCache();
    
    // æŸ¥è¯¢
    bool IsLoaded(string path);
    int GetReferenceCount(string path);
    int CacheCount { get; }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ³›å‹æ–¹æ³•æ”¯æŒå„ç§èµ„æºç±»å‹
- åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§åŠ è½½æ–¹å¼
- æ”¯æŒè¿›åº¦å›è°ƒï¼ˆUX ä¼˜åŒ–ï¼‰
- æä¾›æŸ¥è¯¢æ¥å£ä¾¿äºè°ƒè¯•

---

### 2. ResourceCache èµ„æºç¼“å­˜

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/ResourceCache.cs`

**è®¾è®¡ç›®çš„**ï¼š
- é¿å…é‡å¤åŠ è½½ç›¸åŒèµ„æº
- ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
- æ§åˆ¶å†…å­˜ä½¿ç”¨

**æ ¸å¿ƒæ•°æ®ç»“æ„**ï¼š

```csharp
internal class ResourceCacheItem
{
    public string Path;                  // èµ„æºè·¯å¾„
    public UnityEngine.Object Asset;     // èµ„æºå¯¹è±¡
    public int ReferenceCount;           // å¼•ç”¨è®¡æ•° â­
    public DateTime LastAccessTime;      // æœ€åè®¿é—®æ—¶é—´ï¼ˆLRUï¼‰â­
    public long Size;                    // èµ„æºå¤§å°ä¼°ç®—
}

public class ResourceCache
{
    // åŒç´¢å¼•è®¾è®¡ â­
    private Dictionary<string, ResourceCacheItem> _cacheByPath;    // è·¯å¾„ç´¢å¼•
    private Dictionary<UnityEngine.Object, ResourceCacheItem> _cacheByAsset;  // å¯¹è±¡ç´¢å¼•
    
    private long _maxCacheSize;   // æœ€å¤§ç¼“å­˜å¤§å°
    private long _currentCacheSize;  // å½“å‰ç¼“å­˜å¤§å°
}
```

**å…³é”®å®ç°**ï¼š

#### 1. åŒç´¢å¼•è®¾è®¡

```csharp
// ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç´¢å¼•ï¼Ÿ
_cacheByPath[path] = item;    // é€šè¿‡è·¯å¾„å¿«é€ŸæŸ¥æ‰¾
_cacheByAsset[asset] = item;  // é€šè¿‡å¯¹è±¡å¿«é€ŸæŸ¥æ‰¾

// ä½¿ç”¨åœºæ™¯
// åœºæ™¯1ï¼šé€šè¿‡è·¯å¾„åŠ è½½
var asset = _cacheByPath["UI/MainMenu"];

// åœºæ™¯2ï¼šé€šè¿‡å¯¹è±¡é‡Šæ”¾
GridFramework.Resource.Release(gameObject);  // éœ€è¦é€šè¿‡å¯¹è±¡æ‰¾åˆ°è·¯å¾„
```

#### 2. å¼•ç”¨è®¡æ•°

```csharp
public void Add(string path, UnityEngine.Object asset)
{
    if (_cacheByPath.TryGetValue(path, out var item))
    {
        item.ReferenceCount++;  // å·²å­˜åœ¨ï¼Œå¢åŠ å¼•ç”¨
        return;
    }
    
    // æ–°å»ºç¼“å­˜é¡¹ï¼Œå¼•ç”¨è®¡æ•°ä¸º 1
    var cacheItem = new ResourceCacheItem(path, asset);
    _cacheByPath[path] = cacheItem;
}

public void RemoveReference(string path)
{
    if (_cacheByPath.TryGetValue(path, out var item))
    {
        item.ReferenceCount = Mathf.Max(0, item.ReferenceCount - 1);
        // å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶æ‰å¯ä»¥è¢« LRU æ¸…ç†
    }
}
```

#### 3. LRU ç¼“å­˜ç­–ç•¥

```csharp
private void CheckCacheSize()
{
    if (_currentCacheSize <= _maxCacheSize)
        return;
    
    // æŒ‰æœ€åè®¿é—®æ—¶é—´æ’åº
    var sortedItems = new List<ResourceCacheItem>(_cacheByPath.Values);
    sortedItems.Sort((a, b) => a.LastAccessTime.CompareTo(b.LastAccessTime));
    
    // ç§»é™¤å¼•ç”¨è®¡æ•°ä¸º 0 çš„æœ€æ—§èµ„æº
    foreach (var item in sortedItems)
    {
        if (item.ReferenceCount <= 0)
        {
            RemoveFromCache(item);
            
            if (_currentCacheSize <= _maxCacheSize * 0.8f)  // æ¸…ç†åˆ° 80%
                break;
        }
    }
}
```

**è®¾è®¡äº®ç‚¹**ï¼š
- **åŒé‡ä¿æŠ¤**ï¼šå¼•ç”¨è®¡æ•° + LRUï¼Œä¸ä¼šè¯¯åˆ æ­£åœ¨ä½¿ç”¨çš„èµ„æº
- **æ¸è¿›å¼æ¸…ç†**ï¼šæ¸…ç†åˆ° 80% è€Œé 100%ï¼Œé¿å…é¢‘ç¹è§¦å‘
- **å¤§å°ä¼°ç®—**ï¼šæ ¹æ®èµ„æºç±»å‹ä¼°ç®—å¤§å°ï¼Œæ§åˆ¶æ€»å†…å­˜

---

### 3. IResourceLoader åŠ è½½å™¨æ¥å£

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Interface/IResourceLoader.cs`

**è®¾è®¡ç›®çš„**ï¼š
- æŠ½è±¡åŠ è½½é€»è¾‘
- æ”¯æŒå¤šç§åŠ è½½æ–¹å¼
- ä¾¿äºæ‰©å±•æ–°çš„åŠ è½½å™¨

**æ¥å£å®šä¹‰**ï¼š

```csharp
public interface IResourceLoader
{
    T Load<T>(string path) where T : UnityEngine.Object;
    Task<T> LoadAsync<T>(string path, Action<float> onProgress = null) where T : UnityEngine.Object;
    void Release(UnityEngine.Object asset);
    bool Exists(string path);
    
    string LoaderName { get; }
    bool IsAvailable { get; }  // â­ è¿è¡Œæ—¶å¯ç”¨æ€§æ£€æŸ¥
}
```

**ä¸ºä»€ä¹ˆéœ€è¦ IsAvailableï¼Ÿ**

```csharp
// AddressableLoader å¯èƒ½ä¸å¯ç”¨ï¼ˆæœªå®‰è£…åŒ…ï¼‰
public bool IsAvailable => _isAddressablesAvailable;

// ResourcesLoader å§‹ç»ˆå¯ç”¨
public bool IsAvailable => true;

// ä½¿ç”¨åœºæ™¯
if (loader.IsAvailable)
{
    // ä½¿ç”¨æ­¤åŠ è½½å™¨
}
else
{
    // é™çº§åˆ°å…¶ä»–åŠ è½½å™¨
}
```

---

### 4. ResourcesLoader å®ç°

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/ResourcesLoader.cs`

**å®ç°è¦ç‚¹**ï¼š

```csharp
public T Load<T>(string path) where T : UnityEngine.Object
{
    try
    {
        var asset = Resources.Load<T>(path);
        if (asset == null)
        {
            Debug.LogWarning($"èµ„æºåŠ è½½å¤±è´¥: {path}");
        }
        return asset;
    }
    catch (Exception e)
    {
        Debug.LogError($"èµ„æºåŠ è½½å¼‚å¸¸: {path}\n{e}");
        return null;
    }
}
```

**ä¸ºä»€ä¹ˆè¦ try-catchï¼Ÿ**
- Resources.Load å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼ˆè·¯å¾„éæ³•ã€ç±»å‹é”™è¯¯ï¼‰
- ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼Œé¿å…å´©æºƒ
- æä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

**å¼‚æ­¥åŠ è½½å®ç°**ï¼š

```csharp
public async Task<T> LoadAsync<T>(string path, Action<float> onProgress = null) 
    where T : UnityEngine.Object
{
    var request = Resources.LoadAsync<T>(path);
    
    // è½®è¯¢æ£€æŸ¥è¿›åº¦
    while (!request.isDone)
    {
        onProgress?.Invoke(request.progress);  // å›è°ƒè¿›åº¦
        await Task.Yield();  // è®©å‡ºæ§åˆ¶æƒï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
    }
    
    onProgress?.Invoke(1f);  // å®Œæˆæ—¶å›è°ƒ 100%
    return request.asset as T;
}
```

**ä¸ºä»€ä¹ˆç”¨ Task.Yield()ï¼Ÿ**
- `await Task.Yield()` è®©å‡ºå½“å‰å¸§
- é¿å…é˜»å¡ä¸»çº¿ç¨‹
- ä¿æŒæ¸¸æˆæµç•…è¿è¡Œ

---

### 5. AddressableLoader åå°„å®ç°

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/AddressableLoader.cs`

**æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
- Addressables æ˜¯å¯é€‰åŒ…ï¼Œå¯èƒ½æœªå®‰è£…
- ä¸èƒ½ç›´æ¥ `using UnityEngine.AddressableAssets`ï¼ˆä¼šç¼–è¯‘é”™è¯¯ï¼‰
- éœ€è¦è¿è¡Œæ—¶æ£€æµ‹æ˜¯å¦å¯ç”¨

**è§£å†³æ–¹æ¡ˆï¼šåå°„**

```csharp
private bool _isAddressablesAvailable;
private Type _addressablesType;
private MethodInfo _loadAssetAsyncMethod;
private MethodInfo _releaseMethod;

private void CheckAddressablesAvailability()
{
    // é€šè¿‡å®Œå…¨é™å®šåæŸ¥æ‰¾ç±»å‹
    _addressablesType = Type.GetType(
        "UnityEngine.AddressableAssets.Addressables, Unity.Addressables"
    );
    
    if (_addressablesType != null)
    {
        // è·å–æ–¹æ³•
        _loadAssetAsyncMethod = _addressablesType.GetMethod(
            "LoadAssetAsync",
            BindingFlags.Public | BindingFlags.Static,
            null,
            new Type[] { typeof(object) },
            null
        );
        
        _releaseMethod = _addressablesType.GetMethod("Release", ...);
        
        _isAddressablesAvailable = true;
    }
}
```

**ä¸ºä»€ä¹ˆç”¨åå°„ï¼Ÿ**
1. **æ¡ä»¶ä¾èµ–** - Addressables åŒ…å¯èƒ½ä¸å­˜åœ¨
2. **åŠ¨æ€æ£€æµ‹** - è¿è¡Œæ—¶åˆ¤æ–­æ˜¯å¦å¯ç”¨
3. **é¿å…ç¼–è¯‘é”™è¯¯** - ä¸éœ€è¦ `#if` é¢„å¤„ç†æŒ‡ä»¤
4. **ç”¨æˆ·å‹å¥½** - è‡ªåŠ¨é™çº§ï¼Œä¸æŠ¥é”™

**åå°„è°ƒç”¨ç¤ºä¾‹**ï¼š

```csharp
public async Task<T> LoadAsync<T>(string path, Action<float> onProgress = null) 
    where T : UnityEngine.Object
{
    if (!_isAddressablesAvailable)
    {
        Debug.LogError("Addressables ä¸å¯ç”¨");
        return null;
    }
    
    // ä½¿ç”¨åå°„è°ƒç”¨ Addressables.LoadAssetAsync<T>(path)
    var genericMethod = _loadAssetAsyncMethod.MakeGenericMethod(typeof(T));
    var handle = genericMethod.Invoke(null, new object[] { path });
    
    // è·å–å±æ€§ï¼ˆä¹Ÿæ˜¯åå°„ï¼‰
    var isDoneProperty = handle.GetType().GetProperty("IsDone");
    var percentProperty = handle.GetType().GetProperty("PercentComplete");
    var resultProperty = handle.GetType().GetProperty("Result");
    
    // ç­‰å¾…åŠ è½½å®Œæˆ
    while (!(bool)isDoneProperty.GetValue(handle))
    {
        float progress = (float)percentProperty.GetValue(handle);
        onProgress?.Invoke(progress);
        await Task.Yield();
    }
    
    return resultProperty.GetValue(handle) as T;
}
```

**åå°„çš„æ€§èƒ½å½±å“**ï¼š
- é¦–æ¬¡è·å–æ–¹æ³•/å±æ€§ï¼š~0.1msï¼ˆåˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§ï¼‰
- åç»­è°ƒç”¨ï¼š~0.01msï¼ˆå¯å¿½ç•¥ï¼‰
- ç›¸æ¯”åŠ è½½èµ„æºæœ¬èº«çš„æ—¶é—´ï¼ˆå‡ ååˆ°å‡ ç™¾msï¼‰ï¼Œåå°„å¼€é”€å¯ä»¥å¿½ç•¥

---

### 6. AutoResourceLoader è‡ªåŠ¨åŠ è½½å™¨

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/AutoResourceLoader.cs`

**è®¾è®¡æ ¸å¿ƒ**ï¼šæ¸…å•æŸ¥è¯¢ + è¯•é”™é™çº§

#### æ ¸å¿ƒæ€è·¯

```
åŠ è½½èµ„æº
  â†“
â”œâ”€ æœ‰æ¸…å•ï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ æŸ¥è¯¢æ¸…å•ï¼ˆ0msï¼‰â­â­â­
â”‚   â”‚   â”œâ”€ åœ¨æ¸…å•ä¸­ â†’ Addressables
â”‚   â”‚   â””â”€ ä¸åœ¨æ¸…å•ä¸­ â†’ Resources
â”‚   â”‚
â”‚   â””â”€ å¦ â†’ è¯•é”™æ¨¡å¼
â”‚       â”œâ”€ å…ˆ Resourcesï¼ˆ0.1msï¼‰â­â­
â”‚       â””â”€ å Addressablesï¼ˆ5-10msï¼‰â­
```

#### æ¸…å•æŸ¥è¯¢å®ç°

```csharp
public async Task<T> LoadAsync<T>(string path, Action<float> onProgress = null) 
    where T : UnityEngine.Object
{
    // ç­–ç•¥1ï¼šæ¸…å•æŸ¥è¯¢ï¼ˆæœ€å¿«ï¼Œ0msï¼‰â­â­â­
    if (_manifestLoaded && _manifest.Contains(path))
    {
        Debug.Log($"æ¸…å•å‘½ä¸­ï¼Œä½¿ç”¨ Addressables: {path}");
        return await _addressableLoader.LoadAsync<T>(path, onProgress);
    }
    
    // ç­–ç•¥2ï¼šç¼“å­˜æŸ¥è¯¢ï¼ˆæ¬¡å¿«ï¼Œ0msï¼‰â­â­
    if (_addressableCheckCache.TryGetValue(path, out bool isAddressable))
    {
        if (isAddressable)
            return await _addressableLoader.LoadAsync<T>(path, onProgress);
        else
            return await _resourcesLoader.LoadAsync<T>(path, onProgress);
    }
    
    // ç­–ç•¥3ï¼šè¯•é”™æ¨¡å¼ï¼ˆé™çº§ï¼Œ0.1-5msï¼‰â­
    // å…ˆå¿«åæ…¢
    var asset = await _resourcesLoader.LoadAsync<T>(path, onProgress);
    if (asset != null)
    {
        _addressableCheckCache[path] = false;  // ç¼“å­˜ç»“æœ
        return asset;
    }
    
    if (_addressablesAvailable)
    {
        asset = await _addressableLoader.LoadAsync<T>(path, onProgress);
        if (asset != null)
        {
            _addressableCheckCache[path] = true;  // ç¼“å­˜ç»“æœ
            return asset;
        }
    }
    
    return null;
}
```

**ä¸‰å±‚ä¼˜åŒ–æœºåˆ¶**ï¼š

| å±‚çº§ | æ–¹å¼ | è€—æ—¶ | å‘½ä¸­ç‡ | ä¼˜å…ˆçº§ |
|------|------|------|--------|--------|
| ç¬¬1å±‚ | æ¸…å•æŸ¥è¯¢ | 0ms | 100%ï¼ˆæœ‰æ¸…å•ï¼‰ | â­â­â­ |
| ç¬¬2å±‚ | ç¼“å­˜æŸ¥è¯¢ | 0ms | 90%+ï¼ˆäºŒæ¬¡åŠ è½½ï¼‰ | â­â­ |
| ç¬¬3å±‚ | è¯•é”™æ¨¡å¼ | 0.1-5ms | 100%ï¼ˆé™çº§ï¼‰ | â­ |

**ä¸ºä»€ä¹ˆå…ˆ Resources å Addressablesï¼Ÿ**

```
æ€§èƒ½åˆ†æï¼š
- Resources.Load æ£€æµ‹ï¼š~0.1msï¼ˆå†…å­˜å“ˆå¸Œè¡¨æŸ¥æ‰¾ï¼‰
- Addressables æ£€æµ‹ï¼š~5-10msï¼ˆèµ„æºå®šä½ç³»ç»ŸæŸ¥è¯¢ï¼‰

å‡è®¾ 80% èµ„æºåœ¨ Resourcesï¼Œ20% åœ¨ Addressablesï¼š

æ–¹æ¡ˆ1ï¼ˆæ¡†æ¶é‡‡ç”¨ï¼‰ï¼šå…ˆ Resources
- 80 Ã— 0.1ms + 20 Ã— 5.1ms = 110ms

æ–¹æ¡ˆ2ï¼šå…ˆ Addressables
- 100 Ã— 5.1ms = 510ms

èŠ‚çœï¼š400msï¼ˆå¿« 4.6 å€ï¼‰
```

---

### 7. AddressableResourceManifest æ¸…å•

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/AddressableResourceManifest.cs`

**è®¾è®¡ç›®çš„**ï¼š
- æå‰ç”Ÿæˆèµ„æºç´¢å¼•
- è¿è¡Œæ—¶é›¶å¼€é”€æŸ¥è¯¢
- é¿å…è¯•é”™æ£€æµ‹

**æ•°æ®ç»“æ„**ï¼š

```csharp
[CreateAssetMenu]
public class AddressableResourceManifest : ScriptableObject
{
    public List<ResourceEntry> resources;  // åºåˆ—åŒ–å­˜å‚¨
    
    // è¿è¡Œæ—¶ä¼˜åŒ–ï¼ˆä¸åºåˆ—åŒ–ï¼‰â­
    [NonSerialized] private HashSet<string> _addressHashSet;  // å¿«é€ŸæŸ¥è¯¢
    [NonSerialized] private Dictionary<string, ResourceEntry> _addressDictionary;  // è¯¦ç»†ä¿¡æ¯
    [NonSerialized] private bool _initialized;
    
    public void Initialize()
    {
        // æ„å»ºå“ˆå¸Œè¡¨
        _addressHashSet = new HashSet<string>();
        _addressDictionary = new Dictionary<string, ResourceEntry>();
        
        foreach (var entry in resources)
        {
            _addressHashSet.Add(entry.address);
            _addressDictionary[entry.address] = entry;
        }
        
        _initialized = true;
    }
    
    public bool Contains(string address)
    {
        if (!_initialized) Initialize();
        return _addressHashSet.Contains(address);  // O(1) æŸ¥è¯¢
    }
}
```

**ä¸ºä»€ä¹ˆç”¨ HashSetï¼Ÿ**

```
æ€§èƒ½å¯¹æ¯”ï¼š
- List.Contains(): O(n) - çº¿æ€§æŸ¥æ‰¾ï¼Œ100ä¸ªèµ„æºéœ€è¦100æ¬¡æ¯”è¾ƒ
- HashSet.Contains(): O(1) - å“ˆå¸ŒæŸ¥æ‰¾ï¼Œ1æ¬¡å³å¯

100ä¸ªèµ„æºæŸ¥è¯¢ï¼š
- List: ~0.01ms Ã— 100 = 1ms
- HashSet: ~0.00001ms Ã— 100 = 0.001ms

HashSet å¿« 1000 å€ï¼
```

**ä¸ºä»€ä¹ˆä¸åºåˆ—åŒ– HashSetï¼Ÿ**

```csharp
// List åºåˆ—åŒ–åˆ° ScriptableObjectï¼ˆæŒä¹…åŒ–ï¼‰
public List<ResourceEntry> resources;

// HashSet ä¸åºåˆ—åŒ–ï¼ˆè¿è¡Œæ—¶æ„å»ºï¼‰â­
[NonSerialized] private HashSet<string> _addressHashSet;

åŸå› ï¼š
1. ScriptableObject ä¸æ”¯æŒç›´æ¥åºåˆ—åŒ– HashSet
2. ä» List æ„å»º HashSet å¾ˆå¿«ï¼ˆ~0.1msï¼Œ100ä¸ªèµ„æºï¼‰
3. åˆå§‹åŒ–æ—¶æ„å»ºä¸€æ¬¡å³å¯
```

---

### 8. AddressableManifestGenerator æ¸…å•ç”Ÿæˆå™¨

**æ–‡ä»¶**ï¼š`Assets/Framework/Editor/Resource/AddressableManifestGenerator.cs`

**è®¾è®¡ç›®çš„**ï¼š
- ç¼–è¾‘å™¨å·¥å…·ï¼Œè‡ªåŠ¨æ‰«æ Addressable èµ„æº
- ç”Ÿæˆèµ„æºæ¸…å•æ–‡ä»¶
- æ”¯æŒ GUI å’Œå‘½ä»¤è¡Œä¸¤ç§æ–¹å¼

**æ ¸å¿ƒå®ç°**ï¼š

```csharp
void GenerateManifest()
{
    // 1. æ£€æŸ¥ Addressables æ˜¯å¦å®‰è£…ï¼ˆåå°„ï¼‰
    var addressablesSettingsType = Type.GetType(
        "UnityEditor.AddressableAssets.Settings.AddressableAssetSettings, Unity.Addressables.Editor"
    );
    
    if (addressablesSettingsType == null)
    {
        EditorUtility.DisplayDialog("æœªå®‰è£…", "è¯·å®‰è£… Addressables åŒ…", "ç¡®å®š");
        return;
    }
    
    // 2. è·å– Addressables Settingsï¼ˆåå°„ï¼‰
    var getSettingsMethod = addressablesSettingsType.GetMethod("get_DefaultObject", ...);
    var settings = getSettingsMethod?.Invoke(null, null);
    
    // 3. åˆ›å»ºæˆ–åŠ è½½æ¸…å•
    var manifest = AssetDatabase.LoadAssetAtPath<AddressableResourceManifest>(MANIFEST_PATH);
    if (manifest == null)
    {
        manifest = CreateInstance<AddressableResourceManifest>();
        AssetDatabase.CreateAsset(manifest, MANIFEST_PATH);
    }
    
    manifest.Clear();
    
    // 4. éå†æ‰€æœ‰åˆ†ç»„ï¼ˆåå°„ï¼‰
    var groupsProperty = addressablesSettingsType.GetProperty("groups");
    var groups = groupsProperty.GetValue(settings) as IList;
    
    foreach (var group in groups)
    {
        // è·å–åˆ†ç»„ä¸­çš„æ¡ç›®
        var entriesProperty = group.GetType().GetProperty("entries");
        var entries = entriesProperty?.GetValue(group) as IList;
        
        foreach (var entry in entries)
        {
            // è·å– Address å’Œ GUID
            var address = entry.GetType().GetProperty("address")?.GetValue(entry) as string;
            var guid = entry.GetType().GetProperty("guid")?.GetValue(entry) as string;
            
            // æ·»åŠ åˆ°æ¸…å•
            manifest.AddResource(address, assetType, guid, assetPath, groupName);
        }
    }
    
    // 5. ä¿å­˜æ¸…å•
    EditorUtility.SetDirty(manifest);
    AssetDatabase.SaveAssets();
}
```

**ä¸ºä»€ä¹ˆç”¨åå°„è®¿é—® Addressables Editor APIï¼Ÿ**

1. **é¿å…ç¼–è¯‘ä¾èµ–** - Editor ä»£ç åœ¨ `#if UNITY_EDITOR` ä¸­
2. **åŒ…å¯é€‰** - Addressables å¯èƒ½æœªå®‰è£…
3. **å…¼å®¹æ€§** - ä¸åŒç‰ˆæœ¬ API å¯èƒ½å˜åŒ–

---

### 9. ResourceCenter ç®¡ç†ä¸­å¿ƒ

**æ–‡ä»¶**ï¼š`Assets/Framework/Core/Systems/Resource/ResourceCenter.cs`

**è®¾è®¡ç›®çš„**ï¼š
- ç»Ÿä¸€èµ„æºç®¡ç†å…¥å£
- ç®¡ç†å¤šä¸ªåŠ è½½å™¨
- é›†æˆç¼“å­˜ç³»ç»Ÿ

**æ ¸å¿ƒå®ç°**ï¼š

```csharp
public class ResourceCenter : IResource
{
    private readonly ResourceCache _cache;  // ç¼“å­˜ç®¡ç†å™¨
    private IResourceLoader _loader;  // å½“å‰åŠ è½½å™¨
    private readonly Dictionary<ResourceLoaderType, IResourceLoader> _loaders;  // åŠ è½½å™¨å­—å…¸
    
    public ResourceCenter()
    {
        _cache = new ResourceCache(100f);  // 100MB ç¼“å­˜
        _loaders = new Dictionary<ResourceLoaderType, IResourceLoader>();
        
        // æ³¨å†Œä¸‰ä¸ªåŠ è½½å™¨
        RegisterLoader(ResourceLoaderType.Auto, new AutoResourceLoader());
        RegisterLoader(ResourceLoaderType.Resources, new ResourcesLoader());
        RegisterLoader(ResourceLoaderType.Addressables, new AddressableLoader());
        
        // é»˜è®¤ä½¿ç”¨è‡ªåŠ¨åŠ è½½å™¨
        CurrentLoaderType = ResourceLoaderType.Auto;
    }
}
```

**åŠ è½½æµç¨‹**ï¼š

```csharp
public async Task<T> LoadAsync<T>(string path) where T : UnityEngine.Object
{
    // 1. å…ˆä»ç¼“å­˜è·å– â­
    var cachedAsset = _cache.Get<T>(path);
    if (cachedAsset != null)
    {
        _cache.AddReference(path);  // å¢åŠ å¼•ç”¨è®¡æ•°
        return cachedAsset;
    }
    
    // 2. ä½¿ç”¨åŠ è½½å™¨åŠ è½½
    var asset = await _loader.LoadAsync<T>(path);
    
    // 3. åŠ å…¥ç¼“å­˜
    if (asset != null)
    {
        _cache.Add(path, asset);
    }
    
    return asset;
}
```

**åˆ†å±‚è®¾è®¡**ï¼š

```
ResourceCenterï¼ˆç®¡ç†å±‚ï¼‰
  â”œâ”€ æä¾›ç»Ÿä¸€æ¥å£
  â”œâ”€ ç®¡ç†ç¼“å­˜
  â””â”€ åˆ‡æ¢åŠ è½½å™¨
     â†“
ResourceCacheï¼ˆç¼“å­˜å±‚ï¼‰
  â”œâ”€ LRU ç­–ç•¥
  â””â”€ å¼•ç”¨è®¡æ•°
     â†“
IResourceLoaderï¼ˆåŠ è½½å±‚ï¼‰
  â”œâ”€ AutoResourceLoader
  â”œâ”€ ResourcesLoader
  â””â”€ AddressableLoader
```

---

## è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

```csharp
// IResourceLoader æ˜¯ç­–ç•¥æ¥å£
public interface IResourceLoader { ... }

// ä¸åŒçš„åŠ è½½ç­–ç•¥
public class ResourcesLoader : IResourceLoader { ... }
public class AddressableLoader : IResourceLoader { ... }
public class AutoResourceLoader : IResourceLoader { ... }

// ResourceCenter æ˜¯ä¸Šä¸‹æ–‡
public class ResourceCenter
{
    private IResourceLoader _loader;  // å½“å‰ç­–ç•¥
    
    public ResourceLoaderType CurrentLoaderType
    {
        set
        {
            _loader = _loaders[value];  // åˆ‡æ¢ç­–ç•¥
        }
    }
}
```

**å¥½å¤„**ï¼š
- åŠ è½½æ–¹å¼å¯ä»¥è¿è¡Œæ—¶åˆ‡æ¢
- æ–°å¢åŠ è½½å™¨æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ï¼‰

### 2. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

```csharp
public class GridFramework : MonoBehaviour
{
    public static GridFramework Instance;
    
    void Awake()
    {
        Instance = this;
    }
    
    public static IResource Resource => Instance?._resource;
}
```

**ä¸ºä»€ä¹ˆç”¨å•ä¾‹ï¼Ÿ**
- å…¨å±€å”¯ä¸€çš„èµ„æºç®¡ç†å™¨
- æ–¹ä¾¿è®¿é—®ï¼ˆGridFramework.Resourceï¼‰
- é¿å…é‡å¤åˆå§‹åŒ–

### 3. ä¾èµ–æ³¨å…¥æ¨¡å¼ï¼ˆDI Patternï¼‰

```csharp
public class ResourceCenter : IResource
{
    [Inject]
    public ResourceCenter()
    {
        // Zenject è‡ªåŠ¨æ³¨å…¥
    }
}

// FrameworkInstaller ä¸­æ³¨å†Œ
Container.Bind<IResource>().To<ResourceCenter>().AsSingle();
```

**å¥½å¤„**ï¼š
- è§£è€¦åˆ
- ä¾¿äºæµ‹è¯•
- ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†

### 4. å¯¹è±¡æ± æ¨¡å¼ï¼ˆObject Pool Patternï¼‰

```csharp
public class GameObjectPool
{
    private readonly Stack<GameObject> _pool;  // æ± 
    
    public GameObject Spawn()
    {
        if (_pool.Count > 0)
            return _pool.Pop();  // ä»æ± ä¸­è·å–
        else
            return Object.Instantiate(_prefab);  // åˆ›å»ºæ–°å¯¹è±¡
    }
    
    public void Despawn(GameObject obj)
    {
        obj.SetActive(false);
        _pool.Push(obj);  // å½’è¿˜åˆ°æ± 
    }
}
```

**æ ¸å¿ƒåŸç†**ï¼š
- å¯¹è±¡å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
- å‡å°‘ GC å‹åŠ›
- å†…å­˜ç¨³å®š

### 5. å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

```csharp
// ObjectPool æ˜¯é€šç”¨å·¥å‚
public class ObjectPool<T> where T : class, new()
{
    private readonly Func<T> _createFunc;  // å¯¹è±¡åˆ›å»ºå·¥å‚æ–¹æ³•
    
    public ObjectPool(Func<T> createFunc = null)
    {
        _createFunc = createFunc ?? (() => new T());
    }
    
    public T Spawn()
    {
        return _pool.Count > 0 ? _pool.Pop() : _createFunc();
    }
}

// ä½¿ç”¨
var pool = new ObjectPool<GameEvent>(
    createFunc: () => new GameEvent()  // è‡ªå®šä¹‰åˆ›å»ºé€»è¾‘
);
```

---

## å…³é”®æŠ€æœ¯ç‚¹

### 1. åå°„ï¼ˆReflectionï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ£€æµ‹ Addressables æ˜¯å¦å®‰è£…
- åŠ¨æ€è°ƒç”¨ Addressables API
- è®¿é—® Addressables Editor API

**å®ç°è¦ç‚¹**ï¼š

```csharp
// æŸ¥æ‰¾ç±»å‹
Type type = Type.GetType("å®Œå…¨é™å®šå, ç¨‹åºé›†å");

// æŸ¥æ‰¾æ–¹æ³•
MethodInfo method = type.GetMethod(
    "æ–¹æ³•å",
    BindingFlags.Public | BindingFlags.Static,
    null,
    new Type[] { å‚æ•°ç±»å‹ },
    null
);

// è°ƒç”¨æ–¹æ³•
object result = method.Invoke(null, new object[] { å‚æ•°å€¼ });

// æ³›å‹æ–¹æ³•
MethodInfo genericMethod = method.MakeGenericMethod(typeof(T));
object result = genericMethod.Invoke(null, parameters);
```

**æ€§èƒ½è€ƒè™‘**ï¼š
- åå°„æ¯”ç›´æ¥è°ƒç”¨æ…¢ 10-100 å€
- ä½†ç›¸æ¯”èµ„æºåŠ è½½ï¼ˆå‡ ååˆ°å‡ ç™¾ msï¼‰ï¼Œå¯ä»¥å¿½ç•¥
- ç¼“å­˜ MethodInfo é¿å…é‡å¤æŸ¥æ‰¾

### 2. å¼‚æ­¥ç¼–ç¨‹ï¼ˆasync/awaitï¼‰

**async/await çš„æœ¬è´¨**ï¼š

```csharp
// async æ–¹æ³•è¿”å› Task
public async Task<GameObject> LoadAsync(string path)
{
    var request = Resources.LoadAsync<GameObject>(path);
    
    // await ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
    while (!request.isDone)
    {
        await Task.Yield();  // è®©å‡ºæ§åˆ¶æƒ
    }
    
    return request.asset as GameObject;
}

// ç¼–è¯‘å™¨ç”ŸæˆçŠ¶æ€æœº
// æ¯æ¬¡ await ä¼šæš‚åœæ‰§è¡Œï¼Œä¿å­˜çŠ¶æ€
// å®Œæˆåæ¢å¤æ‰§è¡Œ
```

**Task.Yield() çš„ä½œç”¨**ï¼š

```csharp
await Task.Yield();

// ç­‰ä»·äº
// 1. æš‚åœå½“å‰æ‰§è¡Œ
// 2. è¿”å› Unity ä¸»çº¿ç¨‹
// 3. ä¸‹ä¸€å¸§ç»§ç»­æ‰§è¡Œ

// å¥½å¤„ï¼šä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œæ¸¸æˆä¿æŒæµç•…
```

### 3. æ³›å‹ï¼ˆGenericsï¼‰

**ä¸ºä»€ä¹ˆå¤§é‡ä½¿ç”¨æ³›å‹ï¼Ÿ**

```csharp
// ä¸ç”¨æ³›å‹ï¼ˆéœ€è¦ç±»å‹è½¬æ¢ï¼‰
UnityEngine.Object LoadAsset(string path);

var prefab = LoadAsset("UI/MainMenu") as GameObject;  // éœ€è¦è½¬æ¢
var audio = LoadAsset("Audio/BGM") as AudioClip;

// ä½¿ç”¨æ³›å‹ï¼ˆç±»å‹å®‰å…¨ï¼‰â­
T Load<T>(string path) where T : UnityEngine.Object;

var prefab = Load<GameObject>("UI/MainMenu");  // ç±»å‹å®‰å…¨
var audio = Load<AudioClip>("Audio/BGM");

// å¥½å¤„ï¼š
// 1. ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
// 2. æ— éœ€ç±»å‹è½¬æ¢
// 3. ä»£ç æ›´æ¸…æ™°
```

### 4. çº¦æŸï¼ˆConstraintsï¼‰

```csharp
// æ³›å‹çº¦æŸ
public T Load<T>(string path) where T : UnityEngine.Object
                                      â†‘
                                   çº¦æŸï¼šT å¿…é¡»ç»§æ‰¿ UnityEngine.Object

// ä¸ºä»€ä¹ˆéœ€è¦çº¦æŸï¼Ÿ
// 1. é™åˆ¶ç±»å‹èŒƒå›´ï¼ˆåªèƒ½åŠ è½½ Unity èµ„æºï¼‰
// 2. ç¼–è¯‘æ—¶æ£€æŸ¥
// 3. é¿å…ç±»å‹é”™è¯¯

// âœ… æ­£ç¡®
Load<GameObject>("path");
Load<AudioClip>("path");

// âŒ é”™è¯¯ï¼ˆç¼–è¯‘å¤±è´¥ï¼‰
Load<int>("path");  // int ä¸æ˜¯ UnityEngine.Object
Load<string>("path");  // string ä¸æ˜¯ UnityEngine.Object
```

### 5. å§”æ‰˜å’Œäº‹ä»¶ï¼ˆDelegates & Eventsï¼‰

**è¿›åº¦å›è°ƒ**ï¼š

```csharp
// ä½¿ç”¨ Action<float> ä½œä¸ºè¿›åº¦å›è°ƒ
public async Task<T> LoadAsync<T>(string path, Action<float> onProgress = null)
{
    while (!request.isDone)
    {
        onProgress?.Invoke(request.progress);  // å›è°ƒè¿›åº¦ 0-1
        await Task.Yield();
    }
}

// ä½¿ç”¨
await LoadAsync<GameObject>("path", progress => 
{
    loadingBar.value = progress;  // æ›´æ–°è¿›åº¦æ¡
    loadingText.text = $"{progress * 100:F0}%";
});
```

**ä¸ºä»€ä¹ˆç”¨ Actionï¼Ÿ**
- ç®€æ´ï¼šä¸éœ€è¦å®šä¹‰ delegate
- çµæ´»ï¼šå¯ä»¥æ˜¯åŒ¿åæ–¹æ³•ã€Lambda è¡¨è¾¾å¼
- æ ‡å‡†ï¼š.NET æ ‡å‡†åº“

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¼“å­˜ä¼˜åŒ–

```csharp
// ä¸‰çº§ç¼“å­˜
ç¬¬1çº§ï¼šèµ„æºå¯¹è±¡ç¼“å­˜ï¼ˆResourceCacheï¼‰
  â”œâ”€ é¿å…é‡å¤åŠ è½½
  â””â”€ LRU + å¼•ç”¨è®¡æ•°

ç¬¬2çº§ï¼šæ¸…å•æŸ¥è¯¢ç¼“å­˜ï¼ˆHashSetï¼‰
  â”œâ”€ Addressable èµ„æºç´¢å¼•
  â””â”€ O(1) æŸ¥è¯¢

ç¬¬3çº§ï¼šè¯•é”™ç»“æœç¼“å­˜ï¼ˆDictionaryï¼‰
  â”œâ”€ è®°å½•è¯•é”™ç»“æœ
  â””â”€ é¿å…é‡å¤æ£€æµ‹
```

### 2. æŸ¥è¯¢ä¼˜åŒ–

```csharp
// æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”
æ–¹å¼1ï¼šæ¸…å•æŸ¥è¯¢
_manifest.Contains(path)  // HashSet
â†’ O(1) å¤æ‚åº¦ï¼Œ~0.00001ms

æ–¹å¼2ï¼šè¯•é”™ Resources
Resources.Load(path)
â†’ O(1) å“ˆå¸ŒæŸ¥æ‰¾ï¼Œ~0.1ms

æ–¹å¼3ï¼šè¯•é”™ Addressables
Addressables.LoadResourceLocationsAsync(path)
â†’ èµ„æºå®šä½æŸ¥è¯¢ï¼Œ~5-10ms

ä¼˜å…ˆçº§ï¼šæ¸…å• > Resources > Addressables
```

### 3. å†…å­˜ä¼˜åŒ–

```csharp
// LRU æ¸…ç†ç­–ç•¥
private void CheckCacheSize()
{
    if (_currentCacheSize > _maxCacheSize)
    {
        // åªæ¸…ç†å¼•ç”¨è®¡æ•°ä¸º 0 çš„èµ„æº
        // æ­£åœ¨ä½¿ç”¨çš„èµ„æºä¸ä¼šè¢«æ¸…ç† â­
        foreach (var item in sortedByTime)
        {
            if (item.ReferenceCount <= 0)
            {
                RemoveFromCache(item);
            }
        }
    }
}
```

### 4. å¯¹è±¡æ± ä¼˜åŒ–

```csharp
// å‡å°‘ GC å‹åŠ›
ä¸ä½¿ç”¨å¯¹è±¡æ± ï¼š
- æ¯æ¬¡ Instantiateï¼šåˆ†é…å†…å­˜ + GC
- æ¯æ¬¡ Destroyï¼šæ ‡è®°å¾…å›æ”¶ + GC

ä½¿ç”¨å¯¹è±¡æ± ï¼š
- Spawnï¼šä»æ± ä¸­å–ï¼ˆæ—  GCï¼‰
- Despawnï¼šæ”¾å›æ± ä¸­ï¼ˆæ—  GCï¼‰

æ€§èƒ½æå‡ï¼š
- å‡å°‘ GC æ¬¡æ•° 90%+
- å‡å°‘ CPU å³°å€¼
- å†…å­˜ä½¿ç”¨ç¨³å®š
```

---

## æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### éš¾ç‚¹1ï¼šAddressables å¯é€‰ä¾èµ–

**é—®é¢˜**ï¼š
- Addressables æ˜¯å¯é€‰åŒ…ï¼Œå¯èƒ½æœªå®‰è£…
- ç›´æ¥å¼•ç”¨ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```csharp
// ä½¿ç”¨åå°„åŠ¨æ€æ£€æµ‹å’Œè°ƒç”¨
Type addressablesType = Type.GetType("..., Unity.Addressables");

if (addressablesType != null)
{
    // Addressables å¯ç”¨
}
else
{
    // Addressables ä¸å¯ç”¨ï¼Œé™çº§
}
```

### éš¾ç‚¹2ï¼šå¤šä¸ª Resources ç›®å½•è·¯å¾„å†²çª

**é—®é¢˜**ï¼š
- Unity åˆå¹¶æ‰€æœ‰ Resources ç›®å½•
- å¯èƒ½å‡ºç°è·¯å¾„å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼š
```
å‘½åè§„èŒƒï¼š
- Game/Resources/game_config.json â†’ "game_config"
- Framework/Resources/framework_config.json â†’ "framework_config"
- ä½¿ç”¨å‰ç¼€é¿å…å†²çª
```

### éš¾ç‚¹3ï¼šå¼‚æ­¥åŠ è½½çš„çº¿ç¨‹å®‰å…¨

**é—®é¢˜**ï¼š
- å¤šä¸ªå¼‚æ­¥åŠ è½½å¯èƒ½åŒæ—¶è®¿é—®ç¼“å­˜
- éœ€è¦çº¿ç¨‹å®‰å…¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```csharp
// Unity ä¸»çº¿ç¨‹æ¨¡å‹
// æ‰€æœ‰ async/await éƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
// ä¸éœ€è¦åŠ é”ï¼â­

// Task.Yield() ç¡®ä¿åœ¨ä¸»çº¿ç¨‹
await Task.Yield();  // ä¸‹ä¸€å¸§åœ¨ä¸»çº¿ç¨‹ç»§ç»­
```

### éš¾ç‚¹4ï¼šèµ„æºé‡Šæ”¾æ—¶æœº

**é—®é¢˜**ï¼š
- ä½•æ—¶é‡Šæ”¾èµ„æºï¼Ÿ
- å¼•ç”¨è®¡æ•°å¦‚ä½•ç®¡ç†ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```csharp
// å¼•ç”¨è®¡æ•° + æ‰‹åŠ¨é‡Šæ”¾
Load -> ReferenceCount++
Release -> ReferenceCount--

// ReferenceCount == 0 æ—¶å¯ä»¥è¢« LRU æ¸…ç†
// ä½†ä¸ä¼šç«‹å³æ¸…ç†ï¼Œç­‰ç¼“å­˜æ»¡æ—¶å†æ¸…ç†

// ä¼˜ç‚¹ï¼š
// 1. ä¸ä¼šè¯¯åˆ æ­£åœ¨ä½¿ç”¨çš„èµ„æº
// 2. çŸ­æ—¶é—´é‡å¤åŠ è½½å¯ä»¥å‘½ä¸­ç¼“å­˜
// 3. å†…å­˜å¯æ§
```

---

## æ‰©å±•å¼€å‘æŒ‡å—

### å¦‚ä½•æ·»åŠ æ–°çš„åŠ è½½å™¨

```csharp
// 1. å®ç° IResourceLoader æ¥å£
public class CustomLoader : IResourceLoader
{
    public string LoaderName => "CustomLoader";
    public bool IsAvailable => true;
    
    public T Load<T>(string path) where T : UnityEngine.Object
    {
        // å®ç°åŠ è½½é€»è¾‘
    }
    
    // ... å®ç°å…¶ä»–æ¥å£æ–¹æ³•
}

// 2. åœ¨ ResourceLoaderType æšä¸¾ä¸­æ·»åŠ ç±»å‹
public enum ResourceLoaderType
{
    Auto,
    Resources,
    Addressables,
    Custom  // æ–°å¢
}

// 3. åœ¨ ResourceCenter æ„é€ å‡½æ•°ä¸­æ³¨å†Œ
RegisterLoader(ResourceLoaderType.Custom, new CustomLoader());

// 4. ä½¿ç”¨
var center = GridFramework.Resource as ResourceCenter;
center.CurrentLoaderType = ResourceLoaderType.Custom;
```

### å¦‚ä½•è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥

```csharp
// ç»§æ‰¿ ResourceCache æˆ–åˆ›å»ºæ–°çš„ç¼“å­˜ç±»
public class CustomResourceCache : ResourceCache
{
    // é‡å†™æ¸…ç†ç­–ç•¥
    protected override void CheckCacheSize()
    {
        // è‡ªå®šä¹‰æ¸…ç†é€»è¾‘
        // ä¾‹å¦‚ï¼šFIFOã€éšæœºæ¸…ç†ç­‰
    }
}

// åœ¨ ResourceCenter ä¸­ä½¿ç”¨
_cache = new CustomResourceCache(200f);
```

---

## å­¦ä¹ è¦ç‚¹æ€»ç»“

### æ¶æ„å±‚é¢

1. **åˆ†å±‚è®¾è®¡** - Interface / Center / Loader / Cache å››å±‚æ¶æ„
2. **èŒè´£åˆ†ç¦»** - æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹
3. **å¯æ‰©å±•æ€§** - æ¥å£æŠ½è±¡ + ç­–ç•¥æ¨¡å¼

### æŠ€æœ¯å±‚é¢

1. **åå°„æŠ€æœ¯** - å¤„ç†å¯é€‰ä¾èµ–
2. **å¼‚æ­¥ç¼–ç¨‹** - async/await ä¸é˜»å¡ä¸»çº¿ç¨‹
3. **æ³›å‹çº¦æŸ** - ç±»å‹å®‰å…¨
4. **ç¼“å­˜ç­–ç•¥** - LRU + å¼•ç”¨è®¡æ•°
5. **å“ˆå¸Œä¼˜åŒ–** - HashSet å¿«é€ŸæŸ¥è¯¢

### æ€§èƒ½å±‚é¢

1. **å¤šçº§ç¼“å­˜** - èµ„æºç¼“å­˜ + æ¸…å•ç¼“å­˜ + è¯•é”™ç¼“å­˜
2. **æ™ºèƒ½é™çº§** - æ¸…å• â†’ è¯•é”™ â†’ å¤±è´¥
3. **å…ˆå¿«åæ…¢** - Resources ä¼˜å…ˆäº Addressables
4. **å¯¹è±¡æ± ** - å‡å°‘ GCï¼Œæå‡æ€§èƒ½

---

## æ¨èé˜…è¯»

### Unity å®˜æ–¹æ–‡æ¡£
- Resources API
- Addressables ç³»ç»Ÿ
- ScriptableObject
- AssetBundle

### C# æŠ€æœ¯
- åå°„ï¼ˆReflectionï¼‰
- å¼‚æ­¥ç¼–ç¨‹ï¼ˆasync/awaitï¼‰
- æ³›å‹ï¼ˆGenericsï¼‰
- å§”æ‰˜å’Œäº‹ä»¶

### è®¾è®¡æ¨¡å¼
- ç­–ç•¥æ¨¡å¼
- å•ä¾‹æ¨¡å¼
- å·¥å‚æ¨¡å¼
- å¯¹è±¡æ± æ¨¡å¼

---

**é€šè¿‡å­¦ä¹ è¿™äº›å®ç°ï¼Œä½ å¯ä»¥è®¾è®¡å‡ºæ›´å¥½çš„æ¡†æ¶ï¼** ğŸ“šâœ¨

